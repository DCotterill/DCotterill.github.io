(function(){Strava.module("Strava.Activities"),Strava.Activities.WorkoutTypeMap={run:{run:0,race:1,long_run:2,workout:3},ride:{ride:10,race:11,workout:12}}}).call(this),function(){Strava.module("Strava.Activities"),Strava.Activities.Workouts={TRANSLATION_KEY_PREFIX:"strava.activities.workouts",byKey:function(t){return this._byKey||(this._byKey=Strava.Activities.WorkoutTypeMap),this._byKey[t]},byValue:function(t){var e;return t=t.toLowerCase(),this._byValue||(this._byValue={}),(e=this._byValue)[t]||(e[t]=_.invert(this.byKey(t))),this._byValue[t]},keyForValue:function(t,e){return this.byValue(t)[e]},valueForKey:function(t,e){return this.byKey(t)[e]},asObjects:function(t,e){return null==e&&(e={fullKey:!1}),_.map(this.byKey(t),function(t){return function(r,n){return e.fullKey&&(n=[t.TRANSLATION_KEY_PREFIX,n].join(".")),{key:n,value:r}}}(this))}}}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava"),Strava.base_module={initializeAttributes:function(t){var e,r,n;r=[];for(e in t)n=t[e],r.push(this.initAttribute(e,n));return r},setOrGet:function(t,e){return void 0!==e?(this[t]=e,this):this[t]},initAttribute:function(t,e){var r;return this.constructor.prototype[t]=function(t){return this.setOrGet(r,t)},r="_"+t,this[r]=!_.isObject(e)||_.isFunction(e)||e.constructor!==Object.prototype.constructor&&e.constructor!==Array.prototype.constructor?e:_.clone(e)},create_template:function(t){var e;return e=jQuery(t),this.template=_.template(e.html())},create_template_for:function(t){var e;return e=jQuery(t),_.template(e.html())}},Strava.chart_module={shouldAnimate:function(t){return null!=this.animate()?this.animate():t}},Strava.local_storage_module={initializeStorageAttributes:function(t,e,r){var n,i,a;null==r&&(r=!1),r&&this.setLocalStorage(e,{}),i=[];for(n in t)a=t[n],i.push(this.initStorageAttribute(n,a,e));return i},getLocalStorage:function(t){var e;return e=localStorage[t],e?JSON.parse(localStorage[t])||{}:{}},setLocalStorage:function(t,e){return localStorage[t]=JSON.stringify(e)},setOrGetStorage:function(t,e,r){var n;return n=this.getLocalStorage(r),void 0!==e?(n[t]=e,this.setLocalStorage(r,n),this):n[t]},initStorageAttribute:function(t,e,r){var n,i;if(this.constructor.prototype[t]=function(t){return this.setOrGetStorage(n,t,r)},n="_"+t,!_.isObject(e)||_.isFunction(e)||e.constructor!==Object.prototype.constructor&&e.constructor!==Array.prototype.constructor)return i=this.setOrGetStorage(n,void 0,r),void 0!==i&&(e=i),this.setOrGetStorage(n,e,r);throw new Error("cannot store non-primitive types in localstorage")}},Strava.Base=function(){function t(){}return Strava.includeModule(t,Backbone.Events),Strava.includeModule(t,Strava.base_module),t.prototype.$=function(t,e){return e.find(t)},t.prototype.$$=function(t){return jQuery(t)},t.prototype.$document=function(){return jQuery(document)},t.prototype.one=function(t,e,r){var n,i,a,o;return o=this,n=e,i=t,a=function(){return n.call(this),o.unbind(i,a)},this.bind(t,a,r)},t.prototype.createHandler=function(t){return function(){var e;return e=Array.prototype.slice.call(arguments),e.unshift(this),t.apply(null,e)}},t.prototype.isTouchDevice=function(){return Modernizr?Modernizr.touch:!1},t}(),Strava.Controller=function(e){function r(){r.__super__.constructor.call(this)}return t(r,e),Strava.includeModule(r,Strava.base_module),r.prototype.parse=function(){return{id:0}},r}(Backbone.Model)}.call(this),function(){Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.StreamTransform=function(){function t(){}return t.prototype.transform=function(t,e){return e},t.prototype.dependentStreams=function(){return[]},t}()}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.ConvertedUnitStreamTransform=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.transform=function(t,e){var r,n,i;return i=this.constructor,n=function(){switch(t){case"distance":case"grade_adjusted_distance":case"altitude":return r=i.metersToConverted(t),function(t){return r*t};case"grade_adjusted_pace":case"pace":case"instantaneous_pace":case"instantaneous_grade_adjusted_pace":return r=i.metersToConverted(t),function(t){return t/r};case"velocity":case"velocity_smooth":return r=i.metersToConverted(t),function(t){return t*r*3600};case"temp":return i.getMeasurementUnits().tempConvert;default:return null}}(),n?e.map(n):e},r.getMeasurementUnits=function(){return strava.i18n.measurementUnits()},r.metersToConverted=function(t){var e;switch(e=this.getMeasurementUnits(),t){case"distance":case"grade_adjusted_distance":case"pace":case"grade_adjusted_pace":case"velocity":case"velocity_smooth":case"instantaneous_pace":case"instantaneous_grade_adjusted_pace":return e.longConvert;case"altitude":return e.shortConvert;default:return 1}},r.convertedToMeters=function(t){return 1/this.metersToConverted(t)},r.conversions=function(){return["distance","grade_adjusted_distance","altitude"].reduce(function(t){return function(e,r){return e[r]=t.convertedToMeters(r),e}}(this),{})},r}(Strava.Labs.Activities.StreamTransform)}.call(this),function(){window.strava||(window.strava={}),window.strava.Math||(window.strava.Math={smoothIndices:function(t,e,r,n){for(var i=[],a=0;a<t.length;a++){for(var o=a,s=a,u=0,l=!0;(n?2:1)>u&&(r>s-o+1||t[s]-t[o]<e);){var c=!1;l&&o>0&&(o--,c=!0),!l&&s<t.length-1&&(s++,c=!0),u=c?0:u+1,l=!n||!l}i.push([o,s])}return i},calculateSpeed:function(t,e,r,n,i,a){for(var o=strava.Math.smoothIndices(r?t:e,n,i,r),s=[],u=0,l=0;l<o.length;l++){var c=o[l][0],h=o[l][1],p=e[h]-e[c],d=0;if(p>0){var f=t[h]-t[c];if(d=f/p,l>0){var v=(d-s[u])/(e[l]-e[u]);v>a&&(d=null)}}s.push(null!=d?d:s[u]),null!=d&&(u=l)}return s},yMin:function(t){var e=Math.min.apply(null,t),r=Math.max.apply(null,t),n=r-e,i=Math.floor(Math.log(n)/Math.log(10));i-=1,0>i&&(i=0);var a=Math.pow(10,i),o=Math.floor(e/a)*a;return o-=a},yMax:function(t){return Math.max.apply(null,t)},intervalLength:function(t,e){var r=t/e,n=Math.floor(Math.log(r)/Math.log(10)),i=Math.pow(10,n);return i*Math.ceil(r/i)},isClosest:function(t,e,r){if(r>=t.length-1)return!0;var n=t[r],i=t[r+1];return Math.abs(n-e)<Math.abs(i-e)},closestIndex:function(t,e,r){for(r||(r=0);!strava.Math.isClosest(t,e,r);)r++;return r},range:function(t){return t[t.length-1]-t[0]},patchDataSet:function(t){for(var e=0,r=0,n=0;n<t.length;n++){var i=t[n];if(i){var a=e-(i+r);a>0&&(r+=a),r>0&&(t[n]=i+r),e=t[n]}else t[n]=e}return t},getIntervalIndices:function(t,e){var r=[];if(t.length<=e){for(var n=0;n<t.length;n++)r.push(n);for(n=t.length-1;n>=0;n--)t[n-1]==t[n]&&r.splice(n-1,1)}else{var i=strava.Math.range(t),a=i/(e-1);r=strava.Math.getIndicesAt(t,a)}return r},getIndicesAt:function(t,e,r){var n=[],i=t[0];r&&(i+=e);for(var a=0;a<t.length-1;)for(a=strava.Math.closestIndex(t,i,a),n.push(a);a<t.length-1&&strava.Math.isClosest(t,i,a);)i+=e;return n},rabbitData:function(t,e){for(var r=strava.Math.range(e.time)-strava.Math.range(t.time),n=strava.Math.range(t.distance)/strava.Math.range(e.distance),i={indices:[],timeBehind:[]},a=0,o=0,s=0,u=0;u<t.time.length;u++){var l=t.time[u]-t.time[0]+e.time[0];if(l>e.time[e.time.length-1])a=t.time.length-1,s=r;else{o=strava.Math.closestIndex(e.time,l,o);var c=t.distance[0]+(e.distance[o]-e.distance[0])*n;a=strava.Math.closestIndex(t.distance,c,a),s=t.time[u]-t.time[a]}i.indices.push(a),i.timeBehind.push(s)}return i},closestPoint:function(t,e){var r=t.data;if(r.length<=1||e<=r[0].x)return r[0];for(var n=null,i=0;i<r.length;i++){var a=Math.abs(r[i].x-e);if(null!=n&&a>=n)return r[i-1];n=a}return r[r.length-1]},getSeriesIndices:function(t,e){for(var r=[],n=strava.Math.range(t),i=e;n>i;){var a=r.length>0?r[r.length-1]:0;r.push(strava.Math.closestIndex(t,i,a)),i+=e}return r}})}(jQuery),function(t){window.strava||(window.strava={}),window.strava.globalDispatch||(window.strava.globalDispatch=_.extend({},Backbone.Events)),window.strava.asset||(window.strava.asset={host:function(){return window._asset_host},image:function(t){return strava.asset.url("/images/"+t)},url:function(t){return strava.asset.host()+t},sprite:function(){return"/assets/sprites/sprites-map-2952f0a9e3b82350c97acb7fa5333d10.png"}}),window.strava.forms||(window.strava.forms={Slider:function(e,r){r=t.extend({start:0,end:100,step:1,start_input:"#"+e+"_start",end_input:"#"+e+"_end",label:"."+e,div:"#"+e,plus:!1,time:!1,hours:!0,minutes:!0,seconds:!0,round:!0},r),this.perform_slide=function(e,n){t(r.start_input).val(e),t(r.end_input).val(n);var i=e,a=n;r.time?(i=(new Strava.I18n.TimespanFormatter).display(60*e*60),a=(new Strava.I18n.TimespanFormatter).display(60*n*60)):(i=(new TwitterCldr.DecimalFormatter).format(e),a=(new TwitterCldr.DecimalFormatter).format(n)),t(r.label).html(r.plus&&n==r.end?i+" - "+a+"+":i+" - "+a)},this.start=t(r.start_input).val(),this.end=t(r.end_input).val(),this.start=r.round?parseInt(this.start):parseFloat(this.start),this.end=r.round?parseInt(this.end):parseFloat(this.end);var n=this;this.actual_slider=t(r.div).slider({range:!0,min:r.start,max:r.end,step:r.step,values:[this.start,this.end],slide:function(t,e){n.perform_slide(e.values[0],e.values[1])}}),this.reset=function(){return n.actual_slider?(n.actual_slider.slider("values",0,r.start),void n.actual_slider.slider("values",1,r.end)):!1},this.perform_slide(this.start,this.end)}}),window.strava.sliders||(window.strava.sliders={Slider:function(e,r){r=t.extend({start_icon:"select-start",end_icon:"select-end",start_color:"#54B03A",end_color:"#F00",color:"#105CB6",start:null,end:null,highlight:null,selector:"#slider-range",step:1,slide:null},r);var n=this;this.object=t(r.selector),this.route=e,this.map=e.map,this.start=r.start,this.end=r.end,this.min=0,this.max=n.route.polyline.getLength()-1,this.start="first"==r.start?this.min:this.start?parseInt(this.start):this.min,this.end="last"==r.end?this.max:this.end?parseInt(this.end):Math.floor(e.polyline.getLength()/2),this.start_icon=new strava.maps.Icon(r.start_icon,e.polyline.getAt(this.start),this.map),this.end_icon=new strava.maps.Icon(r.end_icon,e.polyline.getAt(this.end),this.map),this.route.setHighlight(this.start,this.end),this.object.append("<div class='actual-slider'/>"),this.object.append("<div id='start-control'/>"),this.object.find("#start-control").append("<div class='label'>"+Strava.I18n.Locale.t("strava.ui.slider.move_start")+"</div>"),this.object.find("#start-control").append("<button id='move-start-back' class='minimal compact'>"+Strava.I18n.Locale.t("strava.ui.slider.back")+"</button>"),this.object.find("#start-control").append("<button id='move-start-forward' class='minimal compact'>"+Strava.I18n.Locale.t("strava.ui.slider.forward")+"</button>"),this.object.append("<div id='end-control'/>"),this.object.find("#end-control").append("<div class='label'>"+Strava.I18n.Locale.t("strava.ui.slider.move_end")+"</div>"),this.object.find("#end-control").append("<button id='move-end-back' class='minimal compact'>"+Strava.I18n.Locale.t("strava.ui.slider.back")+"</button>"),this.object.find("#end-control").append("<button id='move-end-forward' class='minimal compact'>"+Strava.I18n.Locale.t("strava.ui.slider.forward")+"</button>"),this.actual_slider=this.object.find(".actual-slider"),this.performSlide=function(e,i){e>i&&i==n.end&&(e=n.start),e<n.min&&(e=n.min),i>n.max&&(i=n.max),e>i&&(i=n.end),n.start!=e&&(n.start=e,n.start_icon.move(n.route.polyline.getAt(n.start)),n.start_icon.visible()||n.start_icon.center()),n.end!=i&&(n.end=i,n.end_icon.move(n.route.polyline.getAt(n.end)),n.end_icon.visible()||n.end_icon.center()),n.route.setHighlight(n.start,n.end),t.isFunction(r.slide)&&r.slide(n.start,n.end,n.start_icon,n.end_icon)},this.getStep=function(){var t=n.map.google.getZoom();return t>=17?1:t>=15?2:t>=13?5:t>=10?10:20},this.object.find("#move-start-forward").on("click",function(){n.actual_slider.slider("values",0,n.start+n.getStep()),n.performSlide(n.actual_slider.slider("values",0),n.end)}),this.object.find("#move-start-back").on("click",function(){n.actual_slider.slider("values",0,n.start-n.getStep()),n.performSlide(n.actual_slider.slider("values",0),n.end)}),this.object.find("#move-end-forward").on("click",function(){n.actual_slider.slider("values",1,n.end+n.getStep()),n.performSlide(n.start,n.actual_slider.slider("values",1))}),this.object.find("#move-end-back").on("click",function(){n.actual_slider.slider("values",1,n.end-n.getStep()),n.performSlide(n.start,n.actual_slider.slider("values",1))}),this.actual_slider.slider({range:!0,min:n.min,max:n.max,values:[n.start,n.end],step:r.step,slide:function(t,e){n.performSlide(e.values[0],e.values[1])}}),t(".ui-slider-handle:first").css("background",r.start_color),t(".ui-slider-handle:last").css("background",r.end_color),t(".ui-slider-range").css("background",r.color),this.performSlide(this.start,this.end)}}),window.strava.shareDialogs||(window.strava.shareDialogs={dialogs:{email:t("#email-share-activity-dialog").dialog({autoOpen:!1,resizable:!1,draggable:!1,modal:!0,height:390,width:440,title:"Email",open:Strava.Util.Dialog.setupModalCloseClick}),embed:t("#embed-share-activity-dialog").dialog({autoOpen:!1,resizable:!1,draggable:!1,modal:!0,width:470,title:"Embed a Widget on your Blog",open:Strava.Util.Dialog.setupModalCloseClick})},openShareDialog:function(t){for(var e in strava.shareDialogs.dialogs)e!=t&&strava.shareDialogs.dialogs[e].dialog("close");strava.shareDialogs.dialogs[t].dialog("open")},openFacebook:function(t){var e={method:"feed",name:t.name,link:t.link,picture:t.picture,description:t.message,actions:[{name:t.action,link:t.link}]};FB.ui(e)},openTwitter:function(t){this.inProgressMessage=t.inProgressMessage,this.menuSelector=t.menuSelector;var e=this.dialogs.twitter.find("form");e.find("input[name='id']").attr("value",t.id),e.find("input[name='menu_selector']").attr("value",this.menuSelector),e.find("textarea[name='message']").attr("value",t.message),this.dialogs.twitter.dialog("option","title",t.title),this.openShareDialog("twitter")},openEmail:function(t){this.inProgressMessage=t.inProgressMessage,this.menuSelector=t.menuSelector;var e=this.dialogs.email.find("form");e.find("input[name='activity_id']").attr("value",t.id),e.find("input[name='menu_selector']").attr("value",this.menuSelector),this.dialogs.email.dialog("option","title",t.title),this.openShareDialog("email")},openEmbed:function(t){var e=this.dialogs.embed.find("form");e.find("#embed-label").text(t.label),e.find("textarea").text("<iframe height='405' width='590' frameborder='0' allowtransparency='true' scrolling='no' src='"+t.url+"'></iframe>"),this.dialogs.embed.dialog("option","title",t.title),this.openShareDialog("embed")},menuSelector:"",inProgressMessage:"",initialized:!1,initialize:function(){t("form#share-by-email").submitWithAjax(function(){return strava.shareDialogs.dialogs.email.dialog("close"),jQuery(strava.shareDialogs.menuSelector+" .menu-title").hide(),jQuery(strava.shareDialogs.menuSelector+" .status").html(strava.shareDialogs.inProgressMessage).show(),!0}),t("ul.options, ul.share").on("click","a.facebook-dialog",function(){return t.get(t(this).attr("href"),null,function(t){strava.shareDialogs.openFacebook(t)}),!1}),t("ul.options, ul.share").on("click","a.twitter-dialog",function(){return!0}),t("ul.options, ul.share").on("click","a.embed-dialog",function(){return t.get(t(this).attr("href"),null,function(t){strava.shareDialogs.openEmbed(t)}),!1}),t("ul.options, ul.share").on("click","a.email-dialog",function(){return t.get(t(this).attr("href"),null,function(t){strava.shareDialogs.openEmail(t)}),!1})}}),t.fn.ajaxAnchorLink=function(e){e=t.extend({loadingMsg:"Loading...",beforeLinkHandler:null,afterLinkHandler:null,emptyLinkHandler:null,container:"#secondary-nav"},e),t(window).hashchange(function(){var r=location.hash.replace(/^#/,"");if(r.length>0){var n=t(this).parents(".ajax-loading-container");0==n.length&&(n=t(e.container));var i=n.find(".ajax-loading-status span");t.isFunction(e.beforeLinkHandler)&&e.beforeLinkHandler(this),e.loadingMsg&&(i.html(e.loadingMsg),i.show()),t.getScript(window.location.pathname+"/"+r,function(){t.isFunction(e.afterLinkHandler)&&e.afterLinkHandler(this),i.hide()})}else t.isFunction(e.emptyLinkHandler)&&e.emptyLinkHandler(this)}),t(window).hashchange()},t.fn.clientSideAnchorLink=function(e){e=t.extend({linkHandler:null,emptyLinkHandler:null},e),t(window).hashchange(function(){var r=location.hash.replace(/^#/,"");r.length>0?t.isFunction(e.linkHandler)&&e.linkHandler(r):t.isFunction(e.emptyLinkHandler)&&e.emptyLinkHandler()}),t(window).hashchange()}}(jQuery),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.I18n"),Strava.I18n.ChartLabelElevationFormatter=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.convert=function(t){return t},r}(Strava.I18n.ElevationFormatter)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.I18n"),Strava.I18n.ChartLabelPaceFormatter=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.convert=function(t){return t},r}(Strava.I18n.PaceFormatter)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.I18n"),Strava.I18n.DoubledStepCadenceFormatter=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.convert=function(t){return 2*t},r}(Strava.I18n.StepCadenceFormatter)}.call(this),function(){Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.StreamSplit=function(){function t(t,e,r){this.streamData=t,this.start=e,this.end=r,this.paceFormatter=new Strava.I18n.ChartLabelPaceFormatter,this.elevationFormatter=new Strava.I18n.ChartLabelElevationFormatter,this.heartRateFormatter=new Strava.I18n.HeartRateFormatter,this.cadenceFormatter=new Strava.I18n.DoubledStepCadenceFormatter}return t.prototype.indices=function(){return[this.start,this.end]},t.prototype.setLabel=function(t){return this.label=t},t.prototype.pace=function(){var t,e;return e=this.streamData.get("time"),t=this.distance(),null!=t?(e[this.end]-e[this.start])/t:void 0},t.prototype.formattedPace=function(t){return null==t&&(t=!0),t?this.paceFormatter.abbreviated(this.pace()):this.paceFormatter.format(this.pace())},t.prototype.formattedGAP=function(){return this.paceFormatter.abbreviated(this.gap())},t.prototype.distance=function(){var t;return t=this.streamData.get("distance"),null!=t?t[this.end]-t[this.start]:void 0},t.prototype.gap=function(){var t,e;return this.streamData.has("grade_adjusted_distance")?(t=this.streamData.get("grade_adjusted_distance"),e=this.streamData.get("time"),(e[this.end]-e[this.start])/(t[this.end]-t[this.start])):null},t.prototype.heartrate=function(){var t;return this.streamData.has("heartrate")?(t=this.streamData.get("heartrate"),d3.round(d3.mean(t.slice(this.start,+this.end+1||9e9)))):null},t.prototype.formattedHeartrate=function(){var t;return t=this.heartrate(),t?this.heartRateFormatter.abbreviated(t):null},t.prototype.cadence=function(){var t;return this.streamData.has("cadence")?(t=this.streamData.get("cadence"),d3.round(d3.mean(t.slice(this.start,+this.end+1||9e9)),0)):null},t.prototype.formattedCadence=function(){var t;return t=this.cadence(),t?this.cadenceFormatter.abbreviated(t):null},t.prototype.elevation=function(){var t;return this.streamData.has("altitude")?(t=this.streamData.get("altitude"),t[this.end]-t[this.start]):null},t.prototype.elapsedTime=function(){var t;return t=this.streamData.get("time"),t[this.end]-t[this.start]},t.prototype.spans=function(t,e){return t===this.start&&e===this.end},t.prototype.summarize=function(){var t;return t=null!=this.elevation()?this.elevationFormatter.abbreviated(this.elevation()):void 0,{pace:this.formattedPace(),distance:this.distance(),heartrate:this.formattedHeartrate(),cadence:this.formattedCadence(),gap:this.formattedGAP(),elevation:t,label:this.label,start:this.start,end:this.end}},t}()}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.StreamData=function(e){function r(t,e){null==t&&(t={}),null==e&&(e={}),r.__super__.constructor.call(this),this.initializeAttributes(n),this.data=t,this.derivedData={},this.conversionsToMeters(e)}var n;return t(r,e),n={conversionsToMeters:{}},r.prototype.conversionToMeters=function(t){return this.conversionsToMeters()[t]||1},r.prototype.all=function(){return this.data},r.prototype.get=function(t){return this.data[t]},r.prototype.getInMeters=function(t){var e,r,n;return r=this.data[t],e=this.conversionToMeters(t),null!=e&&1!==e&&(r=function(){var t,i,a;for(a=[],t=0,i=r.length;i>t;t++)n=r[t],a.push(n*e);return a}()),r},r.prototype.has=function(t){return null!=this.data[t]},r.prototype.types=function(){return Object.keys(this.data)},r.prototype.add=function(t,e){return this.data[t]=e},r.prototype.length=function(){var t;return this.has("time")?this.get("time").length:this.has("distance")?this.get("distance").length:(t=types&&types[0])?this.get(t).length:void 0},r.prototype.getAveragePace=function(){return this.fullSplit().pace()},r.prototype.getAverageGap=function(){return this.fullSplit().gap()},r.prototype.getIntervalMax=function(t,e,r){return this.data[t]?d3.max(this.data[t].slice(e,+r+1||9e9)):null},r.prototype.getIntervalAverage=function(t,e,r){var n,i,a,o,s,u,l,c,h,p,d,f,v;if(!this.data[t]||!this.data.time)return null;for(e=e?parseInt(e):0,r=r?parseInt(r):this.data[t].length-1,d=this.data.time.slice(e,+r+1||9e9),f=this.data[t].slice(e,+r+1||9e9),this.data.moving&&(c=this.data.moving.slice(e,+r+1||9e9)),a="cadence"===t,p=0,h=0,s=u=0,l=f.length;l>u;s=++u)v=f[s],null!=c&&!c[s]||a&&0===v||(n=0,s>0&&(n=d[s]-d[s-1]),p+=v*n,h+=n);return"velocity_smooth"===t||"velocity"===t?this.data.distance?(i=this.data.distance[r]-this.data.distance[e],o=h/3600,i/o):null:h>0?p/h:null},r.prototype.estimatedPowerBuckets=function(){var t,e,r,n,i,a;if(null==this.data.watts_calc)return{};for(e=[],i=0,n=0,this.data.watts_calc.forEach(function(t){return function(r,a){var o,s,u;return o=t.data.time[a],u=o-i,i=o,s=Math.round(r),null!=e[s]?e[s]+=u:e[s]=u,s>n?n=s:void 0}}(this)),t=r=0,a=n;a>=r;t=r+=1)null==e[t]&&(e[t]=0);return e},r.prototype.time=function(){return null==this.data.time?null:this.data.time[this.data.time.length-1]-this.data.time[0]},r.prototype.getSmoothPace=function(t,e){var r,n,i,a,o,s,u,l,c,h,p,d,f,v,m,g,y,_,S,w,b,T,L,A;for(null==e&&(e="pace"),l="grade_adjusted_pace"===e?"grade_adjusted_distance":"distance",u=this.get("distance"),v=this.getInMeters("distance"),g=this.getInMeters(l),T=this.get("time"),a=1/this.conversionToMeters("distance"),d=v.length,L=v[d-1],A=t/a,c=A/2,w={time:[],distance:[],pace:[]},p=-1,r=c/2,n=h=0,y=L+r,_=c;_>0?y>=h:h>=y;n=h+=_)f=d3.bisectLeft(v,n-c,0),S=d3.bisectLeft(v,n+c,f,d-1),i=d3.bisectLeft(v,n,f,S),i!==p&&(w.time.push(T[i]),w.distance.push(u[i]),s=T[S]-T[f],o=g[S]-g[f],s>0&&o>0?(b=o/s,m=1/(b*a)):m=w.pace[w.pace.length-1]||0,w.pace.push(m),p=i);return[w.pace,w.distance,w.time]},r.prototype.splits=function(){return this.cachedSplits||(this.cachedSplits=this.splitsForDistanceUnit())},r.prototype.fullSplit=function(){return this.cachedFullSplit||(this.cachedFullSplit=new Strava.Labs.Activities.StreamSplit(this,0,this.length()-1))},r.prototype.splitsForDistanceUnit=function(){var t,e,r,n;return n=this.all(),e=function(t){return function(e,r,n){return new Strava.Labs.Activities.StreamSplit(t,r,n)}}(this),r=this.bucketedIndices(this.get("distance"),1,e),0===r.length?[]:(t=r.length,r.forEach(function(e,r){var n,i,a;return n=e.distance(),a=d3.round(n,1),i=r===t-1&&1>a?(new Strava.I18n.ChartLabelDistanceFormatter).format(n):r+1,e.setLabel(i)}),parseFloat(r[t-1].label)>0||r.pop(),r)},r.prototype.bucketedIndices=function(t,e,r){var n,i,a,o,s,u,l,c,h,p;if(p=0,o=Math.ceil(d3.max(t)/e)*e,e>o)return[];for(c=[],n=a=s=e,u=o,l=e;l>0?u>=a:a>=u;n=a+=l)i=d3.bisectLeft(t,n,p),i===t.length&&(i-=1),h=r(t,p,i),p=i,c.push(h);return c},r.prototype.addIntegratedSeries=function(t,e,r){var n,i,a,o,s,u;if(null!=this.derivedData[r])return this.derivedData[r];if(s=this.data[t],u=this.data[e],null!=s&&null!=u){for(a=[0],n=i=1,o=u.length-1;o>=i;n=i+=1)a[n]=a[n-1]+u[n]*(s[n]-s[n-1]);return this.derivedData[r]=a,a}return null},r.prototype.maxSlopeSubstream=function(t,e,r){var n,i,a,o,s,u,l,c,h;if(h=this.derivedData[t],u=this.data[r],null==h||null==u)return null;for(s=[0,0],o=0,n=null,a=0,c=u.length-1,l=a,i=a;c>i;){for(;c>i&&u[i]-u[l]<e;)i+=1;for(;u[i]-u[l+1]>=e;)l+=1;u[i]-u[l]>=e&&(n=(h[i]-h[l])/(u[i]-u[l]),n>o&&(s=[l,i],o=n)),l+=1}return[e,s[0],s[1],Math.round(o)]},r.prototype.maxForInterval=function(t,e,r){return this.data[t]?d3.max(this.data[t].slice(e,r+1)):0},r}(Strava.Base)}.call(this),function(){Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.StreamsRequest=function(){function t(t){this.streams=t,this.reset()}return t.prototype.reset=function(){return this.required=[],this.deferred=new jQuery.Deferred},t.prototype.require=function(t,e){return this.required=_.uniq(this.required.concat(t)),e&&null!=e.onReady?this.onReady(e.onReady):void 0},t.prototype.request=function(){return 0!==this.required.length?this.streams.fetchStreams(this.required,{success:function(t){return function(){return t.deferred.resolve(),t.reset()}}(this),error:function(t){return function(){return t.deferred.reject(),t.deferred=new jQuery.Deferred}}(this)}):void 0},t.prototype.onReady=function(t){return this.deferred.done(t)},t.prototype.onError=function(t){return this.deferred.fail(t)},t}()}.call(this),function(){Strava.module("Strava.Logging"),Strava.Logging.AjaxLatency=function(){function t(){}var e,r,n;return e="/logging/v1/ajax_latency",r=0,n=0,t.logActivityStreams=!1,t.logSegmentStreams=!1,t.activityStreams=function(t,n,i){return Strava.Logging.AjaxLatency.logActivityStreams?(r++,jQuery.ajax({type:"POST",url:e,data:{metric:"activity_streams",latency:(i/1e3).toFixed(3),details:{request_number:r,types:n,types_count:n.length,activity_id:t},dataType:"json"}})):void 0},t.segmentStreams=function(t,r,i){return Strava.Logging.AjaxLatency.logSegmentStreams?(n++,jQuery.ajax({type:"POST",url:e,data:{metric:"segment_streams",latency:(i/1e3).toFixed(3),details:{request_number:n,types:r,types_count:r.length,segment_id:t},dataType:"json"}})):void 0},t}()}.call(this),function(){var t,e,r,n=function(t,e){function r(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},i={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),r=function(t,e,r){return strava.Math.calculateSpeed(t,e,r,100,3,2)},e=function(t,e,n){var i,a,o,s,u;for(o=r(t,e,n),s=[],i=0,a=o.length;a>i;i++)u=o[i],s.push(0===u?0:1/u);return s},t=function(t,e){var r,n;return n=function(){var n,i,a;for(a=[],r=n=1,i=t.length-1;i>=1?i>=n:n>=i;r=i>=1?++n:--n)a.push((t[r]-t[r-1])/(e[r]-e[r-1]));return a}()},Strava.Labs.Activities.Streams=function(i){function a(t,e,r){null==r&&(r=!1),this.activityId=t,this.streamData=new Strava.Labs.Activities.StreamData,this.requestedTypes=[],this.reduce=e,this.loggedOut=r,a.__super__.constructor.call(this)}var o,s;return n(a,i),a.calculateSpeed=r,a.calculatePace=e,a.calculateDerivative=t,s=["latlng","time","distance","velocity_smooth","watts","watts_calc","grade_adjusted_distance","grade_smooth","heartrate","cadence","resting","altitude","temp","outlier","moving","timer_time"],o={pace:{required:["distance","time"],convert:function(t){var e,r,n;return n=t.get("time"),r=t.get("distance"),e=!0,Strava.Labs.Activities.Streams.calculatePace(r,n,e)}},grade_adjusted_pace:{required:["grade_adjusted_distance","time","altitude"],convert:function(t){var e,r,n;return n=t.get("time"),r=t.get("grade_adjusted_distance"),e=!0,Strava.Labs.Activities.Streams.calculatePace(r,n,e)}},velocity:{required:["distance","time"],convert:function(t){var e,r,n;return n=t.get("time"),r=t.get("distance"),e=!1,Strava.Labs.Activities.Streams.calculateSpeed(r,n,e)}},instantaneous_speed:{required:["distance","time"],convert:function(t){var e,r,n;return r=t.get("time"),e=t.get("distance"),n=Strava.Labs.Activities.Streams.calculateDerivative(e,r),n.unshift(0),n}},instantaneous_acceleration:{required:["instantaneous_speed","time"],convert:function(t){var e,r,n;return r=t.get("time"),e=t.get("instantaneous_speed"),n=Strava.Labs.Activities.Streams.calculateDerivative(e,r),n.unshift(0),n}},instantaneous_pace:{required:["instantaneous_speed"],convert:function(t){var e;return e=t.get("instantaneous_speed"),e.map(function(t){return 1/t})}},instantaneous_grade_adjusted_pace:{required:["grade_adjusted_distance","time"],convert:function(t){var e,r,n;return r=t.get("time"),e=t.get("grade_adjusted_distance"),n=Strava.Labs.Activities.Streams.calculateDerivative(e,r),n.unshift(0),n.map(function(t){return 1/t})}}},a.LOCAL_STREAMS=o,a.REMOTE_STREAMS=s,a.prototype.fetchStreams=function(t,e){var r,n,i,a,o,s,u,l,c;return s=this.classifyTypes(t),l=s[0],n=s[1],r=this.dependentsOf(n),c=_.uniq(t.concat(r)),i=this.neededTypes(c),u=this.classifyTypes(i),o=u[0],a=u[1],this.fetchRemote(o,{success:function(t){return function(r){var n;return n=_.extend(r,t.fetchLocal(a)),t.trigger("fetchSuccess",t.availableStreams()),e.success()}}(this),error:e.error})},a.prototype.localTypes=function(){return Object.keys(o)},a.prototype.streamParentType=function(){return"activity"},a.prototype.classifyTypes=function(t){var e,r;return r=_.intersection(t,s),e=_.intersection(t,this.localTypes()),[r,e]},a.prototype.dependentsOf=function(t){var e,r,n,i;for(e=[],r=0,n=t.length;n>r;r++)i=t[r],e=_.uniq(e.concat(o[i].required));return e},a.prototype.cachedTypes=function(){return this.streamData.types()},a.prototype.fetchRemote=function(t,e){var r,n;return t.length>0?(n=new Date,r={type:"GET",url:this.fetchUrl(),data:this.fetchData(t),cache:!1,success:function(r){return function(i,a){var o;return o=new Date,"activity"===r.streamParentType()&&Strava.Logging.AjaxLatency.activityStreams(r.activityId,t,o.getTime()-n.getTime()),"segment"===r.streamParentType()&&Strava.Logging.AjaxLatency.segmentStreams(r.segmentId,t,o.getTime()-n.getTime()),r.addRequestedTypes(t),r.setStreamsFromResponse(a),e.success(a)}}(this),error:e.error},null!=this.reduce&&(r.reduce=this.reduce),this.fetch(r)):e.success({})},a.prototype.fetchUrl=function(){return this.loggedOut?"/stream/"+this.activityId:"/activities/"+this.activityId+"/streams"},a.prototype.fetchData=function(t){return this.loggedOut?{streams:t}:{stream_types:t}},a.prototype.fetchLocal=function(t){var e,r,n,i,a,s;for(r={},n=0,i=t.length;i>n;n++)s=t[n],e=o[s],this.streamsFetched(e.required)&&(a=e.convert(this.streamData),this.streamData.add(s,a),r[s]=a);return r},a.prototype.neededTypes=function(t){var e;return e=this.cachedTypes(),_.difference(t,e,this.requestedTypes)},a.prototype.addRequestedTypes=function(t){return this.requestedTypes=_.union(this.requestedTypes,t)},a.prototype.setStreamsFromResponse=function(t){var e,r,n;e=[];for(n in t)r=t[n],e.push(this.streamData.add(n,r));return e},a.prototype.streamsFetched=function(t){return t.every(function(t){return function(e){return t.streamFetched(e)}}(this))},a.prototype.streamFetched=function(t){return this.streamData.has(t)},a.prototype.getStream=function(t){return this.streamData.get(t)},a.prototype.availableStreams=function(){return this.streamData.all()},a}(Backbone.Model)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.EqualLengthMovingTimeStreamTransform=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.transform=function(t,e){var r,n,i,a,o,s,u,l;
switch(t){case"resting":return this.resting=e,e;case"time":if(null==this.resting)return[];for(u=0,r=0,i=[],a=o=0,s=e.length;s>o;a=++o)l=e[a],n=l-u,this.resting[a]||(r+=n),i.push(r),u=l;return this.filtered_time=i,i;case"pace":return Strava.Labs.Activities.Streams.calculatePace(this.filtered_distance,this.filtered_time,!0);case"grade_adjusted_pace":return Strava.Labs.Activities.Streams.calculatePace(this.filtered_grade_adjusted_distance,this.filtered_time,!0);case"velocity":return Strava.Labs.Activities.Streams.calculateSpeed(this.filtered_distance,this.filtered_time,!1);default:return null==this.resting?[]:(("distance"===t||"grade_adjusted_distance"===t)&&(this["filtered_"+t]=e),e)}},r.prototype.dependentStreams=function(){return["resting"]},r}(Strava.Labs.Activities.StreamTransform)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.MovingTimeStreamTransform=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.transform=function(t,e){var r,n,i,a,o,s,u,l;switch(t){case"resting":return this.resting=e,e.filter(function(t){return function(e,r){return!t.resting[r]}}(this));case"time":if(null==this.resting)return[];for(u=0,r=0,i=[],a=o=0,s=e.length;s>o;a=++o)l=e[a],n=l-u,this.resting[a]||(r+=n,i.push(r)),u=l;return this.filtered_time=i,i;case"pace":return Strava.Labs.Activities.Streams.calculatePace(this.filtered_distance,this.filtered_time,!0);case"grade_adjusted_pace":return Strava.Labs.Activities.Streams.calculatePace(this.filtered_grade_adjusted_distance,this.filtered_time,!0);case"velocity":return Strava.Labs.Activities.Streams.calculateSpeed(this.filtered_distance,this.filtered_time,!1);default:return null==this.resting?[]:(i=e.filter(function(t){return function(e,r){return!t.resting[r]}}(this)),("distance"===t||"grade_adjusted_distance"===t)&&(this["filtered_"+t]=i),i)}},r.prototype.dependentStreams=function(){return["resting"]},r}(Strava.Labs.Activities.StreamTransform)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.TimerTimeStreamTransform=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.transform=function(t,e){switch(t){case"timer_time":return this.timer_time=e;case"time":return null==this.timer_time?[]:this.timer_time;case"resting":return e.map(function(){return function(){return!1}}(this));case"pace":return Strava.Labs.Activities.Streams.calculatePace(this.distance,this.timer_time,!0);case"grade_adjusted_pace":return Strava.Labs.Activities.Streams.calculatePace(this.grade_adjusted_distance,this.timer_time,!0);case"velocity":return Strava.Labs.Activities.Streams.calculateSpeed(this.distance,this.timer_time,!1);default:return null==this.timer_time?[]:(("distance"===t||"grade_adjusted_distance"===t)&&(this[t]=e),e)}},r.prototype.dependentStreams=function(){return["timer_time"]},r}(Strava.Labs.Activities.StreamTransform)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.ConvertedSwimUnitStreamTransform=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.transform=function(t,e){var r,n,i;return i=this.constructor,n=function(){switch(t){case"distance":case"altitude":return r=i.metersToConverted(t),function(t){return r*t};case"pace":return r=i.metersToConverted(t),function(t){return 100*r*t};case"temp":return i.getMeasurementUnits().tempConvert;default:return null}}(),n?e.map(n):e},r.getMeasurementUnits=function(){return strava.i18n.measurementUnits()},r.metersToConverted=function(t){var e;switch(e=this.getMeasurementUnits(),t){case"distance":case"pace":return e.mediumConvert;case"altitude":return e.shortConvert;default:return 1}},r}(Strava.Labs.Activities.ConvertedUnitStreamTransform)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.StreamTransformSet=function(e){function r(t){this.initializeAttributes(n),this.transforms=t.map(function(t){return new t})}var n;return t(r,e),n={conversionsToMeters:{}},r.CONVERTED_MOVING_TIME="converted-moving-time",r.CONVERTED_ELAPSED_TIME="converted-elapsed-time",r.CONVERTED_TIMER_TIME="converted-timer-time",r.CONVERTED_SWIM_MOVING_TIME="converted-swim-moving-time",r.get=function(t){var e,r;switch(e=this,t){case e.CONVERTED_MOVING_TIME:return r=new e([Strava.Labs.Activities.EqualLengthMovingTimeStreamTransform,Strava.Labs.Activities.ConvertedUnitStreamTransform]),r.conversionsToMeters(Strava.Labs.Activities.ConvertedUnitStreamTransform.conversions());case e.CONVERTED_ELAPSED_TIME:return r=new e([Strava.Labs.Activities.ConvertedUnitStreamTransform]),r.conversionsToMeters(Strava.Labs.Activities.ConvertedUnitStreamTransform.conversions());case e.CONVERTED_SWIM_MOVING_TIME:return r=new e([Strava.Labs.Activities.EqualLengthMovingTimeStreamTransform,Strava.Labs.Activities.ConvertedSwimUnitStreamTransform]),r.conversionsToMeters(Strava.Labs.Activities.ConvertedSwimUnitStreamTransform.conversions());case e.CONVERTED_TIMER_TIME:return r=new e([Strava.Labs.Activities.TimerTimeStreamTransform,Strava.Labs.Activities.ConvertedUnitStreamTransform]),r.conversionsToMeters(Strava.Labs.Activities.ConvertedUnitStreamTransform.conversions());default:return new e([])}},r.prototype.dependentStreams=function(){return this.transforms.reduce(function(t,e){return _.union(t,e.dependentStreams())},[])},r.prototype.transform=function(t,e){var r;return r=e,this.transforms.forEach(function(e){return r=e.transform(t,r)}),r},r}(Strava.Base)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.TrainingActivity=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.initialize=function(){return this.state="new",this.on("change:is_changing_type",this.emitTypeChangeEvents,this)},r.prototype.urlRoot="/athlete/training_activities",r.prototype.load=function(){return this.state="loading",this.trigger(this.state),this.fetch({success:function(t){return function(){return t.state="loaded",t.trigger("loaded",t)}}(this),error:function(t){return function(){return t.state="error",t.trigger("error")}}(this)})},r.prototype.update=function(){return this.state="updating",this.trigger(this.state),this.save({},{success:function(t){return function(){return t.state="loaded",t.trigger("updated",t)}}(this),error:function(t){return function(){return t.state="error",t.trigger("error")}}(this)})},r.prototype.ensureLoaded=function(){return"new"===this.state||"error"===this.state?this.load():void 0},r.prototype.emitTypeChangeEvents=function(){var t,e;return t=this.get("is_changing_type"),e=this.previous("is_changing_type"),t===!0&&e===!1&&this.trigger("typeChange:start",this),t===!1&&e===!0?this.trigger("typeChange:end",this):void 0},r.prototype.isRide=function(){return"Ride"===this.get("type")},r.prototype.isRun=function(){return"Run"===this.get("type")},r.prototype.isSwim=function(){return"Swim"===this.get("type")},r.prototype.isRace=function(){return this.get("workout_type")===Strava.Activities.Workouts.valueForKey(this.get("type").toLowerCase(),"race")},r.prototype.supportsGap=function(){return!!this.get("supportsGap")},r.prototype.isTrainer=function(){return this.get("trainer")},r.prototype.useTimerTime=function(){return this.get("use_timer_time")},r.prototype.defaultTransformSetName=function(){return!this.isRun()||this.isRace()||this.get("trainer")?this.isSwim()?Strava.Labs.Activities.StreamTransformSet.CONVERTED_SWIM_MOVING_TIME:Strava.Labs.Activities.StreamTransformSet.CONVERTED_ELAPSED_TIME:this.useTimerTime()?Strava.Labs.Activities.StreamTransformSet.CONVERTED_TIMER_TIME:Strava.Labs.Activities.StreamTransformSet.CONVERTED_MOVING_TIME},r.prototype.pollForTypeChange=function(){var t;return t=setInterval(function(e){return function(){return e.fetch(),e.has("is_changing_type")&&!e.get("is_changing_type")?clearInterval(t):void 0}}(this),1e3)},r.prototype.getAveragePace=function(){return 1/(this.get("average_speed")/3600)},r}(Backbone.Model)}.call(this),function(){Strava.module("Strava.Athletes.TrainingLog"),Strava.Athletes.TrainingLog.ActivitiesController=function(){function t(){}return Strava.includeModule(t,Backbone.Events),t.prototype.updateWorkoutType=function(t,e,r){var n;return n=new Strava.Labs.Activities.TrainingActivity({id:t,workout_type:e}),n.set("workout_type",r),n.on("updated",function(n){return function(){return n.trigger("workoutTypeChanged",t,e,r)}}(this)),n.on("error",function(e){return function(){return e.handleError(t,r)}}(this)),n.update()},t.prototype.handleError=function(){},t.prototype.getActivityType=function(t){return t.isRide()?"ride":"run"},t}()}.call(this),function(){Strava.module("Strava.D3.Charts"),Strava.D3.Charts.Util={autoDomain:function(t,e){var r,n,i,a,o,s,u,l,c,h;return null==e&&(e={}),_.defaults(e,{paddingBottom:0,paddingTop:0,innerClamp:0}),n=d3.extent(t),a=n[0],i=n[1],s=i-a,e.outerClamp||(e.outerClamp=d3.max([e.innerClamp,s])),r=100-(e.paddingBottom+e.paddingTop),e.innerRange||(e.innerRange=r),h=d3.scale.linear().domain([e.innerClamp,e.outerClamp]).range([e.innerRange,r]).clamp(!0),o=h(s),u=e.paddingBottom+r/2,c=[u-o/2,u+o/2],l=d3.scale.linear().domain(n).range(c),[l.invert(0),l.invert(100)]},closestOrdinalValue:function(t,e){var r,n,i,a,o,s,u;for(s=e.range(),n=i=0,a=s.length;a>i;n=++i)if(u=s[n],u>t||n===s.length-1?r=n:(o=s[n+1],o>t&&(r=o-t>t-u?n:n+1)),"number"==typeof r)return e.domain()[r]},getPathPositionAt:function(t,e){var r,n,i,a;for(i=e,r=t.getTotalLength(),a=null;;){if(a=Math.floor((i+r)/2),n=t.getPointAtLength(a),(a===r||a===i)&&n.x!==e)break;if(n.x>e)r=a;else{if(!(n.x<e))break;i=a}}return n}}}.call(this),function(){Strava.module("Strava.Util"),Strava.Util.I18n=function(){function t(){}return t.stringFormatter=function(t){return new Strava.Util.I18n.StringFormatter(t)},t}(),Strava.Util.I18n.StringFormatter=function(){function t(t){this.RE_URL_ENDING="(?:"+this.RE_URL_MIDCHAR+"*"+this.RE_URL_ENDCHAR+")?",this.RE_FULL_URL=this.RE_URL_SCHEME+"\\w+(?:.\\w+)"+this.RE_URL_ENDING,this.RE_OTHER_URL="\\w[\\w_-]*(?:\\.\\w[\\w_-]*)*\\."+this.RE_TLD+"(?:\\/"+this.RE_URL_ENDING+")?\\b",this.text=t}return t.prototype.RE_EMAIL_PATTERN="\\b[\\w.-]+\\+*[\\w.-]+@(?:(?:[\\w-]+\\.)+[A-Za-z]{2,6}|(?:\\d{1,3}\\.){3}\\d{1,3})",t.prototype.RE_TLD="(?:aero|arpa|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|travel|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|fi|fj|fk|fm|fo|fr|ga|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw)",t.prototype.RE_URL_MIDCHAR="[\\S]",t.prototype.RE_URL_ENDCHAR="[\\w@?^=%&/~+#-]",t.prototype.RE_URL_SCHEME="(?:http|ftp|https|news|mms)://",t.prototype.pluralize=function(t){var e;return e=t>1?this.text+"s":this.text,t+" "+e},t.prototype.nl2br=function(){var t;return null===this.text||void 0===this.text?(this.text="",this):(t=(""+this.text).replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />"),this.text=t,this)},t.prototype.truncate=function(t,e){return null==e&&(e="..."),null==this.text&&(this.text=""),this.text.length>t&&(this.text=this.text.substring(0,t-e.length)+e),this},t.prototype.linkify=function(t){var e;return e=this.text,e=this.match_and_replace(this.RE_EMAIL_PATTERN,e,!1,!1,t),e=this.match_and_replace(this.RE_FULL_URL,e,!0,!1,t),e=this.match_and_replace(this.RE_OTHER_URL,e,!0,!0,t),this.text=e,this},t.prototype.match_and_replace=function(t,e,r,n,i){var a,o,s,u,l,c,h,p,d,f,v,m,g,y;for(g=f=p=c=l=0,u=/<\/[aA]>/,v=new RegExp(t,"g"),h={},d=20;(h=v.exec(e))&&(l++,!(l>d));)if(g=h.index,p=h[0].length,y=e.substring(f,g),y.search(/<[aA]/)>=0){if(u.lastIndex=f,s=e.substring(f,e.length).search(u),0>s)return e;c=s+f,v.lastIndex=c+4,f=c+4}else o=e.substr(g,p),a=e.substr(g,p),n&&(a="http://"+a),m='<a target="_blank" href="',r||(m+="mailto:"),a=a.replace(/"/g,"%22"),m+=a+'"',m+=' title="',m+=r?a:"Email "+a,m+='"',i&&o.length>i&&(o=o.substr(0,i)+"..."),m+=">"+o.replace(new RegExp("([/=])","g"),"<wbr>$1")+"</a>",e=e.slice(0,g)+m+e.slice(g+p,e.length),v.lastIndex=g+m.length,f=g+m.length;return e},t.prototype.end=function(){var t;return t=this.text,this.text=null,t},t.prototype.start=function(t){return this.text=t,this},t}()}.call(this),function(){Strava.module("Strava.Util"),Strava.Util.SportDataFormatter=function(){function t(t){null==t&&(t={}),this.units=t.units||strava.i18n.measurementUnits(),this.convert=_.isUndefined(t.convert)?!0:t.convert,this.timeFormatter=new Strava.I18n.TimespanFormatter,this.numberFormatter=new TwitterCldr.DecimalFormatter}return t.prototype.formatActivityDuration=function(t){return this.timeFormatter.display(t)},t.prototype.formatActivityDateTime=function(t){var e,r,n;return e=t.getUTCHours(),r=t.getUTCMinutes(),n=e>=12?"PM":"AM",r=10>r?"0"+r:r,e=e>12?e-12:e,e+":"+r+" "+n},t.prototype.formatAggregateTrainingDuration=function(t){return this.timeFormatter.abbreviatedNoTags(t,!1)},t.prototype.formatDistance=function(t,e){var r;return null==e&&(e=!1),this.convert&&(t*=this.units.longConvert),r=t.toFixed(1).toString().replace(/\.0$/,""),e?r+" "+this.units.longLabel:r},t.prototype.formatElevation=function(t,e){var r;return null==e&&(e=!1),this.convert&&(t*=this.units.shortConvert),r=this.numberFormatter.format(t,{precision:0}),e?r+" "+this.units.shortLabel:r},t}()}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Util"),Strava.Util.RunDataFormatter=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.formatPace=function(t,e){var r;return null==e&&(e=!1),this.convert&&(t/=this.units.longConvert),t=Math.round(t),r=this.timeFormatter.display(t),e?r+"/"+this.units.longLabel:r},r}(Strava.Util.SportDataFormatter)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Util"),Strava.Util.RideDataFormatter=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.formatSpeed=function(t,e){var r;return null==e&&(e=!0),r=(this.units.longConvert*t*3600).toFixed(1),e?r+" "+this.units.longLabel+"/h":r},r}(Strava.Util.SportDataFormatter)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Util"),Strava.Util.SwimDataFormatter=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.formatDistance=function(t,e){var r;return null==e&&(e=!1),this.convert&&(t*=this.units.mediumConvert),r=this.numberFormatter.format(t,{precision:0}),e?r+" "+this.units.mediumLabel:r},r}(Strava.Util.SportDataFormatter)}.call(this),function(){Strava.module("Strava.Athletes.TrainingLog"),Strava.Athletes.TrainingLog.CircleJammer={getJammedPosition:function(t,e,r){var n,i,a,o,s;return a=t[e],i=t.parent,t.depth>0&&i.children.length>1?(s=Math.atan2(t.y-i.y,t.x-i.x),o="x"===e?Math.cos(s):Math.sin(s),n=(i.r-r(i.value))*o,a-n):a}}}.call(this),function(){Strava.module("Strava.Athletes.TrainingLog"),Strava.Athletes.TrainingLog.TrainingLogDateCalculator={isCurrentWeek:function(t,e){return t>=e&&t<this.oneWeekAfterDate(e)},oneWeekAfterDate:function(t){var e;return e=new Date(t),e.setDate(t.getDate()+7)}}}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Athletes.TrainingLog"),Strava.Athletes.TrainingLog.BubbleChart=function(e){function r(t){r.__super__.constructor.call(this),this.initializeAttributes(n),this.initializeAttributes(t),this.width(this.width()-this.padding().left-this.padding().right),this.setScales(this.scaleBy(),this.scaleExtent()),"run"===this.sport()&&(this.formatter().run=new Strava.Util.RunDataFormatter),"ride"===this.sport()&&(this.formatter().ride=new Strava.Util.RideDataFormatter),"triathlon"===this.sport()&&(this.formatter().run=new Strava.Util.RunDataFormatter,this.formatter().ride=new Strava.Util.RideDataFormatter,this.formatter().swim=new Strava.Util.SwimDataFormatter),this.distanceFormatter=new Strava.I18n.DistanceFormatter,this.elevationFormatter=new Strava.I18n.ElevationFormatter,this.timespanFormatter=new Strava.I18n.TimespanFormatter}var n;return t(r,e),n={data:null,width:null,chart:null,selector:null,minBubbleRadius:14,maxBubbleRadius:54,shelfBubbleThreshold:40.6,rendered:!1,padding:null,rowHeight:null,scaleExtent:[],scaleBy:null,activityClass:"activity",goalBarWidth:120,today:null,tooltip:null,contentTemplate:null,tooltipView:null,xtTooltipView:null,columnOffset:151,shelfTextYPosition:86,belowShelfTextYPosition:110,midRowY:34,dy:3,summaryOrder:["distance","moving_time","elev_gain"],sport:null,formatter:{}},r.prototype.render=function(){var t,e,r,n,i,a;return t=d3.select(this.selector()),this.chart(t),t=t.append("g").attr("transform","translate("+this.padding().left+", "+this.padding().top+")"),r=t.selectAll(".week").data(this.data()).enter().append("g").attr("class","week").attr("transform",function(t){return function(e,r){return"translate(0, "+r*t.rowHeight()+")"}}(this)).attr("data-interval",function(){return function(t){return t.get("id")}}(this)),i=this.rowHeight()/2,n=this.rowHeight(),r.append("line").attr("class","week-shelf").attr("x1",this.columnOffset()).attr("y1",n-28).attr("x2",this.width()).attr("y2",n-28),a=r.append("g").attr("class","week-summaries").attr("transform","translate(0, "+this.midRowY()+")"),"triathlon"===this.sport()?this.addMultiSportSummaries(a):this.addSingleSportSummaries(a),e=r.selectAll(".day-wrap").data(function(t){return _.toArray(t.get("by_day_of_week"))}).enter().append("g").attr("class",function(t){return"training"===t.day_type?"day-wrap day-wrap-children-"+t.activities.length:"day-wrap"}),this.addActivities(e),this.animate(this.data())},r.prototype.addMonthChange=function(t,e,r,n){var i;return i=d3.select(t).append("g").attr("class","month-change").attr("transform","translate("+(Math.round(r)+.5)+", "+(n+.5)+")"),i.append("text").text(this.dateTimeFormatter.formatUTC(e,{format:"additional",type:"MMMd"})).attr("class","month-change-text").attr("transform","translate(0, 115)"),i.append("path").attr("class","month-change-divider").attr("d","M 0 97 L 0 103")},r.prototype.addActivities=function(t){var e,r,n,i,a,o,s;return r=this,e=this.activityClass(),a=this.scaleBy(),n=this.activityScale.domain()[1],o=this.rowHeight()-28,i=this.xScale.rangeBand()/2,s=this.sport(),t.each(function(t){var u,l,c,h,p,d,f,v,m,g,y;return g=r.xScale(t.date.getUTCDay()),y=r.rowHeight()/2-40,c=d3.select(this),c.attr("transform","translate("+(g+i)+", "+y+")"),"planned"!==t.day_type&&c.append("line").attr("class","week-shelf-connection").classed("week-shelf-connection-strong",function(t){return"training"!==t.day_type}).attr("x1",0).attr("x2",0).attr("y1",o-y).attr("y2",function(t){return"training"===t.day_type?r.midRowY():r.shelfTextYPosition()+2}),1===t.date.getUTCDate()&&1!==t.date.getUTCDay()&&(u=g,l=r.midRowY(),r.addMonthChange(this.parentNode,t.date,u,l)),"training"===t.day_type&&(m=_(t.activities).pluck(a).reduce(function(t,e){return t+e}),v=r.activityScale(m),f=d3.layout.pack().children(function(t){return"training"===t.day_type?_.sortBy(t.activities,a).reverse():[]}).size([v,v]).value(function(t){return t[a]}).radius(function(t){return r.activityScale(t)}),c.classed("activity-threshold-below",r.isDayBelowThresholdValue(m)),p=c.selectAll(".activity-link").data(f.nodes,function(t){return 0===t.depth?0:t.id}).enter().append("g").attr("transform","translate("+-(v/2)+", "+(y-v/2-10)+")").attr("class","leaf"),d=p.append("a").attr("class","activity-link").attr("xlink:href",function(t){return t.depth>0?"/activities/"+t.id:void 0}).attr("target","_parent").attr("id",function(t){return t.depth>0?"activity-link-"+t.id:void 0}).attr("transform",function(t){return g=r.getJammedXPosition(t),y=r.getJammedYPosition(t),"translate("+g+", "+y+")"}).on("mouseover",function(t){return function(e){return r.handleMouseOver(t,e)}}(this)).on("mouseout",function(t){return function(e){return r.handleMouseOut(t,e)}}(this)),d.append("circle").attr("class",function(t){var n;return n={depth:t.depth,sport:s},n.type=t.depth>0?"triathlon"===s?t.type.toLowerCase():t.workout_type:"wrapper",r.getClassName(e,n)}).attr("id",function(t){return"activity-"+t.id}).attr("cx",0).attr("cy",0).attr("r",0).classed("activity-threshold-zero",function(t){return 0===t.value}).classed("activity-threshold-above",function(t){return t.value>=n}),d.filter(function(t){return t.depth>0}).append("text").attr("class",function(t){var e;return e={depth:t.depth},r.getClassName("day-total",e)}).attr("transform",function(){return"translate(0, "+r.dy()+")"}).text(function(t){return r.formatActivityValue(a,t.value)})),h=c.append("g").attr("class","day-summary").attr("transform","translate(0, "+r.midRowY()+")"),h.filter(function(t){return"training"===t.day_type}).append("text").attr("class","sum sum-"+s+" no-rest").text(function(t){return r.formatActivityValue(a,t.value)}),r.addRestDays(c),r.addXTDays(c)})},r.prototype.addRestDays=function(t){var e;return e=Strava.I18n.Locale.t("strava.athletes.training_log.bubble_chart.rest"),t.filter(function(t){return"rest"===t.day_type}).append("text").attr("transform","translate(0, "+this.shelfTextYPosition()+")").attr("class","rest-day").text(e)},r.prototype.addXTDays=function(t){var e,r,n;return e=this,n=Strava.I18n.Locale.t("strava.athletes.training_log.bubble_chart.xt"),r=Strava.I18n.Locale.t("strava.athletes.training_log.bubble_chart.plus_xt"),t.filter(function(t){return t.xt_activities.length>0}).append("text").attr("transform",function(t){return function(e){return t.isSpaceAvailable(e)?"translate(0, "+t.shelfTextYPosition()+")":"translate(0, "+t.belowShelfTextYPosition()+")"}}(this)).attr("class","xt-day").text(function(t){return"active"===t.day_type?n:r}).on("mouseover",function(t){return e.handleXTMouseOver(this,t)}).on("mouseout",function(){return e.handleXTMouseOut()})},r.prototype.handleXTMouseOver=function(t,e){var r,n,i,a,o;return d3.select(t).classed("active",!0),r=d3.event.target?d3.event.target:d3.event.toElement,i=this.getElementPosition(r),this.xtTooltipView().render(e),a=i.left+i.element.width/2-this.tooltip().el().outerWidth()/2,o=i.top+i.element.height+6,this.tooltip().el()[0].getBoundingClientRect().height+o>=jQuery(window).height()+window.scrollY?(n=!0,o=i.top-this.tooltip().el().outerHeight()-6):n=!1,this.tooltip().position(a,o).above(n).show()},r.prototype.handleXTMouseOut=function(){var t,e;return e=jQuery(d3.event.relatedTarget),t=d3.event.target,e.hasClass("strava-tt")||e.hasClass("tt-hit-area")?(e=e.hasClass("strava-tt")?e:e.parents(".strava-tt"),e.on("mouseleave",function(r){return function(){return e.off("mouseleave"),d3.select(t).classed("active",!1),r.hideTooltip()}}(this))):(d3.select(t).classed("active",!1),this.hideTooltip())},r.prototype.handleMouseOver=function(t,e){return t=d3.select(t),t.classed("active")===!1&&(this.resetActiveDay(),t.moveToFront(),t.classed("active",!0),this.expandOuterCircle(t,e)),e.depth>0?(this.updateTooltip(e),this.positionTooltip(t,e)):void 0},r.prototype.positionTooltip=function(t,e){var r,n,i,a,o,s,u,l;return r=d3.select("#activity-"+e.id),r.classed("active",!0),i=!1,o=this.getElementPosition(e.parent.children.length>1?r[0][0]:"#activity-"+e.id),l=o.top+o.element.height+3,e.parent.children.length>1&&(s=this.getElementPosition(t.select(".activity-type-wrapper")[0][0]),n=Math.round(o.top+o.element.height/2),a=Math.round(s.top+s.element.height/2),a>n&&(i=!0,l=o.top-this.tooltip().el().outerHeight()-5),d3.select("#activity-link-"+e.id).moveToFront(),t.select(".day-summary").moveToFront()),this.tooltip().el()[0].getBoundingClientRect().height+l>=jQuery(window).height()+window.scrollY&&(i=!0,l=o.top-this.tooltip().el().outerHeight()-5),l<window.scrollY&&(i=!1,l=o.top+o.element.height+3),u=o.left-this.tooltip().el().outerWidth()/2+o.element.width/2,this.tooltip().position(u,l).above(i).show()},r.prototype.handleMouseOut=function(t){var e;return e=jQuery(d3.event.relatedTarget),e.hasClass("workout-type-toggle")?void 0:e.hasClass(this.activityClass())||d3.select(e[0]).classed(this.activityClass())?d3.selectAll(this.selector()+" circle.active").classed("active",!1):e.hasClass("strava-tt")||e.hasClass("tt-hit-area")?(e=e.hasClass("strava-tt")?e:e.parents(".strava-tt"),e.on("mouseleave",function(t){return function(r){return jQuery(r.target).hasClass("workout-type-toggle")||(e.off("mouseleave"),t.hideTooltip(function(){return t.tooltipView().cleanup()}),d3.select(t.selector()+" g.active").select(".day-summary").moveToFront(),"circle"===r.relatedTarget.nodeName)?void 0:t.resetActiveDay()}}(this))):(this.hideTooltip(function(t){return function(){return t.tooltipView().cleanup()}}(this)),this.resetActiveDay(),d3.select(t).select(".day-summary").moveToFront())},r.prototype.hideTooltip=function(t){return null==t&&(t=null),this.tooltip().hide(t)},r.prototype.expandOuterCircle=function(t){return t.selectAll(".activity-link").transition().duration(300).attr("transform",function(t){return"translate("+t.x+", "+t.y+")"}),t.selectAll(".activity-type-wrapper").transition().duration(300).attr("r",function(t){return t.r})},r.prototype.resetOuterCircle=function(t){return t.selectAll(".activity-link").transition().ease("elastic",2,1).duration(800).attr("transform",function(t){return function(e){return"translate("+t.getJammedXPosition(e)+","+t.getJammedYPosition(e)+")"}}(this)),t.selectAll(".activity-type-wrapper").transition().duration(400).attr("r",function(t){return function(e){return t.activityScale(e.value)}}(this))},r.prototype.resetActiveDay=function(){var t;return t=d3.select(this.selector()+" g.active"),this.resetOuterCircle(t),d3.selectAll(this.selector()+" g.active, "+this.selector()+" circle.active").classed("active",!1)},r.prototype.getElementPosition=function(t){var e,r;return r=jQuery(window),e=t instanceof String?this.chart().select(t)[0][0].getBoundingClientRect():d3.select(t)[0][0].getBoundingClientRect(),{element:e,left:e.left+r.scrollLeft(),top:e.top+r.scrollTop()}},r.prototype.updateActivity=function(t,e){var r;if(r=this.chart().selectAll("."+this.activityClass()).filter(function(e){return e.id===t}),r[0].length>0)switch(e){case"workout_type":return this.updateWorkoutType(r)}},r.prototype.updateWorkoutType=function(t){return t.attr("class",function(t){return function(e){var r;return r={depth:e.depth,sport:t.sport()},r.type="triathlon"===t.sport()?e.type.toLowerCase():e.workout_type,t.getClassName(t.activityClass(),r)}}(this)).classed("activity-threshold-zero",function(t){return 0===t.value}).classed("activity-threshold-above",function(t){return function(e){return e.depth>0&&e.r===t.maxBubbleRadius()}}(this)).classed("active",!0)},r.prototype.updateTooltip=function(t){var e,r,n,i,a,o;return a=t.type.toLowerCase(),r="run"===a?0:10,o=null===t.workout_type||0===t.workout_type?r:t.workout_type,n="swim"===a?(new Strava.I18n.SwimDistanceFormatter).formatShort(t.distance):(new Strava.I18n.DistanceFormatter).formatShort(t.distance),e={sport:a,activityId:t.id,date:t.date,name:t.name,distance:n,time:(new Strava.I18n.TimespanFormatter).display(t.moving_time),timeKey:"templates.athletes.training_log.tt_content.moving_time",elev:(new Strava.I18n.ElevationFormatter).formatShort(t.elev_gain),workoutTypeId:o,workoutTypes:Strava.Activities.Workouts.asObjects(a,{fullKey:!0}),description:t.description},"run"===a&&("race"===Strava.Activities.Workouts.keyForValue(a,o)?(e.time=this.timespanFormatter.display(t.elapsed_time),e.timeKey="templates.athletes.training_log.tt_content.elapsed_time",i=t.distance/t.elapsed_time):i=t.speed,e.pace=(new Strava.I18n.PaceFormatter).formatShort(i)),"ride"===a&&(e.avg_watts=(new TwitterCldr.DecimalFormatter).format(t.avg_watts),e.speed=(new Strava.I18n.DistancePerTimeFormatter).formatShort(3600*t.speed)),this.tooltipView().render(e)},r.prototype.getJammedXPosition=function(t){return Strava.Athletes.TrainingLog.CircleJammer.getJammedPosition(t,"x",this.activityScale)},r.prototype.getJammedYPosition=function(t){return Strava.Athletes.TrainingLog.CircleJammer.getJammedPosition(t,"y",this.activityScale)},r.prototype.addSingleSportSummaries=function(t){var e;return e=this.summaryOrder(),t.append("text").attr("class","date-range").attr("transform","translate(0, 2)").text(function(t){return function(e){return t.dateRangeLabel(e)}}(this)),t.append("text").attr("class","week-total-primary").text(function(t){return function(r){return t.formatAggregateValue(e[0],r.get(e[0]),!1)}}(this)).attr("transform",function(){var t;return t="1"===this.textContent.charAt(0)?-5:-2,"translate("+t+", 64)"}).append("tspan").attr("class","week-total-unit").text(function(t){return function(){return" "+t.getLabel(e[0])}}(this)),t.append("text").attr("class","week-total-secondary").text(function(t){return function(r){return t.formatAggregateValue(e[1],r.get(e[1]))}}(this)).attr("transform","translate(0, 20)"),t.append("text").attr("class","week-total-tertiary").text(function(t){return function(r){return t.formatAggregateValue(e[2],r.get(e[2]))}}(this)).attr("transform","translate(120, 20)"),"triathlon"!==this.sport()?this.addGoals(t):void 0},r.prototype.addMultiSportSummaries=function(t){var e,r,n,i,a,o;return o=Strava.I18n.Locale.t("strava.activities.types.swim"),r=Strava.I18n.Locale.t("strava.activities.types.ride"),i=Strava.I18n.Locale.t("strava.activities.types.run"),t.append("text").attr("class","date-range").attr("transform","translate(0, 0)").text(function(t){return function(e){return t.dateRangeLabel(e)}}(this)),t.append("text").attr("class","week-total-primary").text(function(t){return function(e){var r,n;return n=e.get("totals_by_sport"),r=n.ride.moving_time+n.swim.moving_time+n.run.moving_time,t.formatAggregateValue("moving_time",r,!1)}}(this)).attr("transform",function(){var t;return t="1"===this.textContent.charAt(0)?-5:-2,"translate("+t+", 34)"}),a=t.append("text").attr("class","swim-summary sport-summary-type").attr("transform","translate(0, 62)").text(o),e=t.append("text").attr("class","ride-summary sport-summary-type").attr("transform","translate(0, 81)").text(r),n=t.append("text").attr("class","run-summary sport-summary-type").attr("transform","translate(0, 99)").text(i),this.charOffset||(this.charOffset=_.max([a[0][0].getComputedTextLength(),e[0][0].getComputedTextLength(),n[0][0].getComputedTextLength()])+10),t.append("text").attr("class","swim-summary sport-summary").attr("transform","translate("+this.charOffset+", 62)").text(function(t){return function(e){var r;return r=e.get("totals_by_sport").swim.moving_time,r>0?t.formatAggregateValue("moving_time",r):"-"}}(this)),t.append("text").attr("class","ride-summary sport-summary").attr("transform","translate("+this.charOffset+", 81)").text(function(t){return function(e){var r;
return r=e.get("totals_by_sport").ride.moving_time,r>0?t.formatAggregateValue("moving_time",r):"-"}}(this)),t.append("text").attr("class","run-summary sport-summary").attr("transform","translate("+this.charOffset+", 99)").text(function(t){return function(e){var r;return r=e.get("totals_by_sport").run.moving_time,r>0?t.formatAggregateValue("moving_time",r):"-"}}(this))},r.prototype.addGoals=function(t){var e,r;return e=this.getFormatter(this.sport()),r=t.append("g").attr("class","goal").classed("goal-is-set",function(t){return t.hasGoal()}).classed("goal-is-completed",function(t){return t.hasGoal()&&t.isGoalCompleted()}).attr("transform","translate(0, 76)"),r.append("rect").attr("class","goal-bg").attr("transform","translate(0, 21)").attr("width",this.goalBarWidth()).attr("height",2),r.filter(function(t){return t.hasGoal()}).append("rect").attr("class","goal-status").attr("transform","translate(0, 21)").attr("width",function(t){return function(e){return t.goalXScale.domain([0,e.get("entry").goal.goal]),t.goalXScale(e.get(e.goalMetric()))}}(this)).attr("height",2),r.append("text").attr("class","goal-text").attr("transform","translate(0, 13)").text(function(){return function(t){var r,n;return t.hasGoal()?(r=t.get("entry").goal,n="DistanceGoal"===r.type?(new Strava.I18n.GoalDistanceFormatter).formatShort(r.goal):e.formatAggregateTrainingDuration(r.goal),Strava.I18n.Locale.t("strava.athletes.training_log.bubble_chart.goal",{goal:n})):void 0}}(this))},r.prototype.animate=function(){return this.chart().selectAll("."+this.activityClass()).transition().duration(700).attr("r",function(t){return function(e){return t.getRadius(e)}}(this)),jQuery(this.selector()).parent().addClass("chart-rendered")},r.prototype.getClassName=function(t,e){var r,n;r=[t];for(n in e)r.push(t+"-"+n+"-"+e[n]);return r.join(" ")},r.prototype.getRadius=function(t){return 0!==t.depth?t.r:t.children&&t.children.length>1?this.activityScale(t.value):void 0},r.prototype.updateChartScaleValue=function(t,e){var r,n,i,a,o,s;return this.setScales(t,e),a=this.activityScale.domain()[1],s=this.summaryOrder(),n=d3.selectAll(this.selector()+" .week"),r=this,n.selectAll(".week-total-unit").remove(),n.selectAll(".week-total-primary").text(function(t){return function(e){return t.formatAggregateValue(s[0],e.get(s[0]),!1)}}(this)).attr("transform",function(){var t;return t="1"===this.textContent.charAt(0)?-5:-2,"translate("+t+", 64)"}).append("tspan").attr("class","week-total-unit").text(function(e){return function(){return" "+e.getLabel(t)}}(this)),n.selectAll(".week-total-secondary").text(function(t){return function(e){return t.formatAggregateValue(s[1],e.get(s[1]))}}(this)),n.selectAll(".week-total-tertiary").text(function(t){return function(e){return t.formatAggregateValue(s[2],e.get(s[2]))}}(this)),i=r.maxBubbleRadius(),o=r.minBubbleRadius(),n.selectAll(".day-wrap").filter(function(t){return"training"===t.day_type}).each(function(e){var n,a,o,u,l,c;return u=_(e.activities).pluck(t).reduce(function(t,e){return t+e}),o=r.activityScale(u),a=d3.layout.pack().children(function(e){return _.sortBy(e.activities,t).reverse()}).size([o,o]).value(function(e){return e[t]}).radius(function(t){return r.activityScale(t)}),n=d3.select(this),n.selectAll(".activity-link").data(a.nodes,function(t){return 0===t.depth?0:t.id}),n.selectAll(".sum").text(function(){return r.formatActivityValue(s[0],u)}),l=r.xScale(e.date.getUTCDay()),c=r.rowHeight()/2-40,n.selectAll(".leaf").attr("transform","translate("+-(o/2)+", "+(c-o/2-10)+")"),n.selectAll(".activity-link").attr("transform",function(t){return"translate("+r.getJammedXPosition(t)+", "+r.getJammedYPosition(t)+")"}),n.selectAll("."+r.activityClass()).classed("activity-threshold-zero",function(t){return 0===t.value}).classed("activity-threshold-above",function(t){return t.r===i}).transition().duration(300).attr("r",function(t){return r.getRadius(t)}),n.classed("activity-threshold-below",r.isDayBelowThresholdValue(u)),n.selectAll(".day-total").text(function(t){return r.formatActivityValue(s[0],t.value)}),n.selectAll(".xt-day").attr("transform",function(t){return r.isSpaceAvailable(t)?"translate(0, "+r.shelfTextYPosition()+")":"translate(0, "+r.belowShelfTextYPosition()+")"})})},r.prototype.formatAggregateValue=function(t,e,r){return null==r&&(r=!0),"distance"===t?r?this.distanceFormatter.formatShort(e):this.distanceFormatter.format(e,1,!1):"moving_time"===t?this.timespanFormatter.abbreviatedNoTags(e,!1):"elev_gain"===t?r?this.elevationFormatter.formatShort(e):this.elevationFormatter.format(e):void 0},r.prototype.formatActivityValue=function(t,e,r){return null==r&&(r=!1),"distance"===t?r?this.distanceFormatter.formatShort(e):this.distanceFormatter.format(e,1,!1):"moving_time"===t?this.timespanFormatter.abbreviatedNoTags(e,!1):"elev_gain"===t?r?this.elevationFormatter.formatShort(e):this.elevationFormatter.format(e):void 0},r.prototype.getFormatter=function(t){return"run"===t||"triathlon"===t?this.formatter().run:"ride"===t?this.formatter().ride:"swim"===t?this.formatter().swim:void 0},r.prototype.getLabel=function(t){switch(t){case"distance":return this.distanceFormatter.unitShort();case"elev_gain":return this.elevationFormatter.unitShort();default:return""}},r.prototype.isDayBelowThresholdValue=function(t){return this.activityScale(t)===this.minBubbleRadius()},r.prototype.isSpaceAvailable=function(t){return"active"===t.day_type||"rest"===t.day_type?!0:this.activityScale(t.value)<this.shelfBubbleThreshold()},r.prototype.setScales=function(t,e){var r;return this.dayOffsets=[1,2,3,4,5,6,0],r=_.without(this.summaryOrder(),t),r.unshift(t),this.summaryOrder(r),this.scaleBy(t),this.scaleExtent(e),this.xScale=d3.scale.ordinal().rangeBands([this.columnOffset(),this.width()]).domain(this.dayOffsets),this.goalXScale=d3.scale.linear().range([0,this.goalBarWidth()]).clamp(!0),this.activityScale=d3.scale.sqrt().range([this.minBubbleRadius(),this.maxBubbleRadius()]).domain(e).clamp(!0)},r.prototype.dateRangeLabel=function(t){return Strava.Athletes.TrainingLog.TrainingLogDateCalculator.isCurrentWeek(t.get("end_date"),this.today())?Strava.I18n.Locale.t("strava.athletes.training_log.bubble_chart.current_week"):t.dateRange()},r.prototype.units=strava.i18n.measurementUnits(),r.prototype.dateTimeFormatter=new Strava.I18n.DateTimeFormatter,r}(Strava.Base)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Util"),Strava.Util.Fixie=function(e){function r(t,e){r.__super__.constructor.call(this),this.initializeAttributes(n),this.initializeAttributes(e),this.el(jQuery(t)),this.updatePosition(),this.autoStart()&&this.start()}var n;return t(r,e),n={isFixed:!1,token:Math.round(1e4*Math.random()),window:jQuery(window),yPosition:0,el:null,autoStart:!0,fixBuffer:0},r.prototype.start=function(){return this.window().on("scroll.fixie-"+this.token(),function(t){return function(e){return t.checkPosition(e)}}(this)),this.checkPosition()},r.prototype.stop=function(){return this.window().off("scroll.fixie-"+this.token())},r.prototype.checkPosition=function(){return this.window().scrollTop()>this.yPosition()+this.fixBuffer()&&this.isFixed()===!1?(this.el().addClass("is-fixed"),this.isFixed(!0),this.trigger("fix",this)):this.window().scrollTop()<this.yPosition()+this.fixBuffer()&&this.isFixed()===!0?(this.el().removeClass("is-fixed"),this.isFixed(!1),this.trigger("release",this)):void 0},r.prototype.updatePosition=function(){return this.yPosition(this.el().offset().top)},r}(Strava.Base)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Util"),Strava.Util.Fixies=function(e){function r(t,e){null==e&&(e={}),r.__super__.constructor.call(this),this.initializeAttributes(n),this.$target(jQuery(t)),this.create(e),this.start()}var n;return t(r,e),n={token:Math.round(1e4*Math.random()),window:jQuery(window),fixies:[],$target:null,isObserving:!1},r.prototype.create=function(t){return t=_.extend({autoStart:!1},t),this.fixies(_.map(this.$target(),function(e){return function(r){var n;return n=new Strava.Util.Fixie(jQuery(r),t),n.on("all",function(t){return e.isObserving()===!0?e.trigger(t,n):void 0}),n}}(this)))},r.prototype.start=function(){return this.isObserving()===!1?(this.window().on("scroll.fixie-"+this.token(),function(t){return function(e){return t.checkPosition(e)}}(this)),this.isObserving(!0)):void 0},r.prototype.stop=function(){return this.window().off("scroll.fixie-"+this.token()),this.isObserving(!1),this.fixies().forEach(function(t){return t.isFixed(!1)})},r.prototype.updatePosition=_.throttle(function(){return this.fixies().forEach(function(t){return t.updatePosition()})},100),r.prototype.checkPosition=_.throttle(function(){return this.fixies().forEach(function(t){return t.checkPosition()})},100),r.prototype.next=function(t){var e,r;return e=this.fixies(),r=_.indexOf(e,t),r<e.length?e[r+1]:null},r.prototype.previous=function(t){var e,r;return e=this.fixies(),r=_.indexOf(e,t),r>0?e[r-1]:null},r.fixElement=function(t,e){return null==e&&(e={}),new Strava.Util.Fixie(jQuery(t),e)},r}(Strava.Base)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Athletes.TrainingLog"),Strava.Athletes.TrainingLog.CommuteExcluder=function(e){function r(t){this.currentPath=t,r.__super__.constructor.call(this)}return t(r,e),r.prototype.el="#commute-button",r.prototype.events={"click input":"refresh"},r.prototype.includeCommutes=function(){return this.$("input").prop("checked")},r.prototype.refresh=function(){var t;return t=this.currentPath+"&include_commutes="+this.includeCommutes(),window.location.href=t},r}(Backbone.View)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Athletes.TrainingLog"),Strava.Athletes.TrainingLog.FtueView=function(e){function r(t){var e;e={closeOnDocument:!1},this.athleteId=t,this.create_template("#training-log-ftue-content"),this.lightbox=new Strava.Ui.LightboxView("",e),this.lightbox.bind("lightboxClosed",function(t){return function(){return t.closeFtue(),t.undelegateEvents()}}(this)),r.__super__.constructor.call(this)}return t(r,e),r.prototype.className="training-log-ftue-lightbox",r.prototype.events={"click .btn-next":"nextSlide","click .btn-prev":"prevSlide","click .slide-nav li":"pageSlide"},r.prototype.render=function(){return this.renderTemplate(),this.lightbox.render(this.el),this.delegateEvents(),this},r.prototype.nextSlide=function(){var t,e,r;return r=this.$(".slides > div"),e=this.$(".slides .selected"),t=r.index(e),t++,t>r.length-1&&(t=r.index(r.first())),this.gotoSlide(t)},r.prototype.prevSlide=function(){var t,e,r;return r=this.$(".slides > div"),e=this.$(".slides .selected"),t=r.index(e),t--,0>t&&(t=r.index(r.last())),this.gotoSlide(t)},r.prototype.pageSlide=function(t){var e;return e=this.$(".slide-nav li").index(this.$(t.currentTarget)),this.gotoSlide(e)},r.prototype.gotoSlide=function(t){var e,r,n,i;return this.$(".selected").removeClass("selected"),r=this.$(".slides > div")[t],this.$(r).addClass("selected"),e=this.$(".slide-nav li")[t],this.$(e).addClass("selected"),n=this.$(".slides .selected"),i=-1*n.position().left,this.$(".slides").css("left",i)},r.prototype.closeFtue=function(){return jQuery.ajax({url:"/athletes/"+this.athleteId+"/athlete_preferences/set?name=ftue_seen_training_log&value=true",type:"PUT"})},r}(Backbone.View)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Athletes.TrainingLog"),Strava.Athletes.TrainingLog.Interval=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}var n;return t(r,e),n=/(\d{4})[y](?:(\d{2})([mw]))?/,r.parseId=function(t){var e,r,i,a;return e=t.match(n),null==e||null==e[0]?null:(r={year:parseInt(e[1])},a=parseInt(e[2]),i=e[3],a&&i&&("w"===i?r.week=a:"m"===i&&(r.month=a)),r)},r.isWeek=function(t){return"week"in this.parseId(t)},r.isMonth=function(t){return"month"in this.parseId(t)},r.isYear=function(t){var e;return e=_.keys(this.parseId(t)),1===e.length&&"year"===e[0]},r.prototype.initialize=function(){var t,e,r,n;return r=this.get("start_date"),n=new Date(0),n.setUTCSeconds(r),this.set("start_date",n),e=new Date(0),e.setUTCSeconds(this.get("end_date")),this.set("end_date",e),t=this.get("by_day_of_week"),_.each(t,function(t){return function(e,n){var i;return i=parseInt(n)-1,e.date=_.tap(new Date(0),function(t){return t.setUTCSeconds(r),t.setUTCDate(t.getUTCDate()+i)}),e.activities.forEach(t.setDay),e.xt_activities.forEach(t.setDay)}}(this))},r.prototype.setDay=function(t){return t.date=new Date(0),t.date.setUTCSeconds(t.start_date-t.utc_offset),t.day=t.date.getUTCDay()},r.prototype.findActivity=function(t){var e,r,n;return r=this.get("by_day_of_week"),e=_.flatten(_.pluck(r,"activities")),n=_.find(e,function(e){return e.id===t}),n?n:!1},r.prototype.updateActivityWorkoutType=function(t,e){return t.workout_type=e},r.prototype.hasGoal=function(){return this.get("entry").goal&&this.get("entry").goal.goal>0?!0:!1},r.prototype.goalMetric=function(){var t;return t=this.get("entry").goal,null!=t&&"DistanceGoal"===t.type?"distance":"moving_time"},r.prototype.isGoalCompleted=function(){var t;return t=this.get("entry").goal,this.get(this.goalMetric())>t.goal},r.prototype.activityValue=function(t,e){var r,n;return r=this.get("entry").activities,r.length>0?(n=_.pluck(r,t),e(n)):0},r.prototype.dateRange=function(){var t,e,r,n;return t=[],e=new Strava.I18n.DateTimeFormatter,n=this.get("start_date"),r=this.get("end_date"),n.getUTCMonth()===r.getUTCMonth()?(t.push(TwitterCldr.Calendar.calendar.months.format.abbreviated[n.getUTCMonth()+1]),t.push(" "),t.push(n.getUTCDate()+"-"+r.getUTCDate())):(t.push(e.formatUTC(n,{format:"additional",type:"MMMd"})),t.push("-"),t.push(e.formatUTC(r,{format:"additional",type:"MMMd"}))),t.join("")},r}(Backbone.Model)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Athletes.TrainingLog"),Strava.Athletes.TrainingLog.Intervals=function(e){function r(t,e,n,i,a){this.groups=e,this.weeks=n,this.sport=i,this.athleteId=a,r.__super__.constructor.call(this),this.today=new Date(1e3*t),this.on("reset",function(t){return function(){return t.requested=t.pluck("month_interval")}}(this))}return t(r,e),r.prototype.DEFAULT_UPDATE_COUNT=4,r.prototype.model=Strava.Athletes.TrainingLog.Interval,r.prototype.url=function(){return"/athletes/"+this.athleteId+"/training/log/weeks?sport="+this.sport},r.prototype.fetchFrom=function(t,e){var r;return null==e&&(e=DEFAULT_UPDATE_COUNT),r={data:{start_week:t,num_weeks:e},update:!0,remove:!1},this.fetch(r).done(function(t){return function(e){return t.handleSuccess(e)}}(this)).fail(function(t){return function(e){return t.handleFail(e)}}(this))},r.prototype.fetchMonths=function(t){return t.forEach(function(t){return function(e){return t.fetchMonth(e)}}(this))},r.prototype.fetchMonth=function(t){return this.requested.push(t.month_interval),this.fetchFrom(t.last_week_interval,t.num_weeks)},r.prototype.months=function(t,e,r){var n,i,a;return null==e&&(e=1),null==r&&(r=1),i=_.indexOf(_.pluck(this.groups,"month_interval"),t),a=i-e>0?i-e:0,n=i+r<=this.groups.length?i+r:this.groups.length,_.reject(this.groups.slice(a,+n+1||9e9),function(t){return function(e){return t.isRequested(e.month_interval)}}(this))},r.prototype.handleSuccess=function(t){var e,r;return e=_.pluck(t,"month_interval"),r=this.filter(function(){return function(t){return _.contains(e,t.get("month_interval"))}}(this)),this.trigger("updated",r)},r.prototype.handleFail=function(){},r.prototype.isRequested=function(t){return _.contains(this.requested,t)},r.prototype.year=function(t){var e;return e=this.getMonthInterval(t),null!=e?e.year:void 0},r.prototype.month=function(t){var e;return e=this.getMonthInterval(t),null!=e?e.month:void 0},r.prototype.getMonthInterval=function(t){return Strava.Athletes.TrainingLog.Interval.isWeek(t)&&(t=this.weeks[t].month_interval),_.find(this.groups,function(e){return e.month_interval===t})},r.prototype.getWeek=function(t){return parseInt(t.substr(5,2),10)},r.prototype.getWeekNumber=function(t){var e,r,n;return Strava.Athletes.TrainingLog.Interval.isWeek(t)?(r=this.getMonthInterval(t),e=this.getWeek(r.last_week_interval),n=this.getWeek(t),e-n):0},r.prototype.findActivity=function(t){var e;return e=this.find(function(e){return e.findActivity(t)}),e?{interval:e,activity:e.findActivity(t)}:void 0},r.prototype.minWithoutZeros=function(t){return t=_.without(t,0),_.min(t)},r.prototype.comparator=function(t){return-t.get("start_date")},r}(Backbone.Collection)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Athletes.TrainingLog"),Strava.Athletes.TrainingLog.IntervalsView=function(e){function r(t,e,n){r.__super__.constructor.call(this,n),this.sport=e.toLowerCase()||this.defaultSport,this.chartAttrs.sport=this.sport,this.trainingLogViewModel=t,this.chartAttrs.scaleExtent=this.getScaleExtent(this.sport,this.trainingLogViewModel.scaleBy),this.trainingLogViewModel.on("scaleChanged",function(t){return function(e){return t.updateChartScaleValue(e)}}(this)),this.collection.bind("reset",function(t){return function(){return t.render()}}(this)),this.collection.bind("updated",function(t){return function(e){return t.renderMonths(e)}}(this)),this.trainingLogViewModel.on("atInterval",function(t){return function(e,r){return t.jumpToInterval(e,r)}}(this)),this.trainingLogViewModel.on("updateActivity",function(t){return function(e,r,n){return t.handleActivityUpdate(e,r,n)}}(this)),this.tooltip=new Strava.Athletes.TrainingLog.Tooltip,this.tooltipView=new Strava.Athletes.TrainingLog.TooltipView(t,null),this.tooltipView.setElement("#"+this.tooltip.id()),this.chartAttrs.tooltip=this.tooltip,this.chartAttrs.tooltipView=this.tooltipView,this.xtTooltipView=new Strava.Athletes.TrainingLog.XTTooltipView,this.xtTooltipView.setElement("#"+this.tooltip.id()),this.chartAttrs.xtTooltipView=this.xtTooltipView,this.monthTitles=new Strava.Util.Fixies(this.$(".month-block"),{fixBuffer:-60}),this.monthTitles.on("fix",function(t){return function(e){return t.handleMonthFix(e)}}(this)),this.monthTitles.on("release",function(t){return function(e){return t.handleMonthRelease(e)}}(this))}return t(r,e),r.prototype.charts=[],r.prototype.defaultSport="run",r.prototype.scaleExtents={run:{distance:[3218.69,42003.88],elev_gain:[30.48,914.4],moving_time:[1200,10800]},ride:{distance:[16093.4,160934],elev_gain:[457.2,2133.6],moving_time:[2700,19800]},triathlon:{moving_time:[1200,21600]}},r.prototype.chartAttrs={width:825,rowHeight:160,scaleExtent:[],padding:{top:0,right:20,bottom:15,left:16}},r.prototype.render=function(){return this.chartAttrs.today=this.collection.today,this.renderMonths(this.collection.models)},r.prototype.renderMonths=function(t){var e,r;return r=_.groupBy(t,function(t){return t.get("month")}),e=_.keys(r).sort().reverse(),e.forEach(function(t){return function(e){var n;return n=parseInt(e,10),t.renderMonth(r[n])}}(this))},r.prototype.renderMonth=function(t){var e,r;return e=_.extend({},this.chartAttrs,{data:t,sport:this.sport}),e.height=e.rowHeight*t.length,r=_.last(t).id,e.scaleBy=this.trainingLogViewModel.scaleBy,e.selector='svg.month-chart[data-first-week-interval="'+r+'"]',this.addChart(e)},r.prototype.updateChartScaleValue=function(t){return this.chartAttrs.scaleExtent=this.getScaleExtent(this.sport,this.trainingLogViewModel.scaleBy),this.charts.forEach(function(e){return function(r){return r.updateChartScaleValue(t,e.chartAttrs.scaleExtent)}}(this))},r.prototype.addChart=function(t,e){var r;return null==e&&(e=!0),r=new Strava.Athletes.TrainingLog.BubbleChart(t),this.charts.push(r),e?r.render():void 0},r.prototype.handleActivityUpdate=function(t,e,r){return this.charts.forEach(function(){return function(n){return n.updateActivity(t,e,r)}}(this))},r.prototype.handleMonthFix=function(t){return this.trainingLogViewModel.gotoInterval(t.el().data("month-interval"),this)},r.prototype.handleMonthRelease=function(t){var e;return e=this.monthTitles.previous(t),e?this.trainingLogViewModel.gotoInterval(e.el().data("month-interval"),this):void 0},r.prototype.getScaleExtent=function(t,e){return this.scaleExtents[t.toLowerCase()][e]},r.prototype.jumpToInterval=function(t,e){var r,n,i,a,o;return e!==this?(this.monthTitles.stop(),i=this.collection.getMonthInterval(t).month_interval,a=this.collection.getWeekNumber(t),r=this.$('.month-block[data-month-interval="'+i+'"]'),o=a*this.chartAttrs.rowHeight-this.chartAttrs.rowHeight/2,n=!1,jQuery("html, body").animate({scrollTop:r.offset().top+o},860,function(t){return function(){return n===!1?(t.monthTitles.checkPosition(),t.monthTitles.start(),n=!0):void 0}}(this))):void 0},r}(Backbone.View)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Athletes.TrainingLog"),Strava.Athletes.TrainingLog.JumpButtonView=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.events={click:"jump"},r.prototype.initialize=function(){return this.isVisible=!1,this.window=jQuery(window),this.checkOffset(),this.window.on("scroll",function(t){return function(){return t.checkOffset()}}(this))},r.prototype.jump=function(){var t;return t=!1,jQuery("html, body").animate({scrollTop:0},860,function(e){return function(){return t?void 0:(e.hide(),t=!0)}}(this))},r.prototype.hide=function(){return this.isVisible?(this.$el.removeClass("reveal"),this.isVisible=!1):void 0},r.prototype.show=function(){return this.isVisible?void 0:(this.$el.addClass("reveal"),this.isVisible=!0)},r.prototype.checkOffset=function(){return this.window.scrollTop()>=2*this.window.height()?this.show():this.hide()},r}(Backbone.View)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Athletes.TrainingLog"),Strava.Athletes.TrainingLog.Race=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r}(Backbone.Model)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["athletes/training_log/race"]=function(t){return function(){var t,e,r;return e=window.HAML.escape,t=window.HAML.cleanValue,r=[],r.push("<li id='race-"+this.activity.id+"' style='display:none' data-interval='"+e(t(this.interval.id))+"'>\n  <span class='clickable'>"+e(t(this.activity.name))+"</span>\n</li>"),r.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Athletes.TrainingLog"),Strava.Athletes.TrainingLog.RaceNavView=function(e){function r(t,e){r.__super__.constructor.call(this,e),jQuery(window).on("resize.racenav",function(t){return function(){return t.checkSizeOfNav(!1)}}(this)),this.trainingLogViewModel=t,this.trainingLogViewModel.on("atInterval",function(t){return function(e){return t.updateInterval(e)}}(this)),this.trainingLogViewModel.on("addRace",function(t){return function(e){return t.addRace(e)}}(this)),this.trainingLogViewModel.on("removeRace",function(t){return function(e){return t.removeRace(e)}}(this)),Strava.Util.Fixies.fixElement(this.el),this.checkSizeOfNav()}return t(r,e),r.prototype.events={"click span.clickable":"gotoInterval"},r.prototype.updateInterval=function(t){var e,r;return e=Strava.Athletes.TrainingLog.Interval.isWeek(t)?this.$('.races li[data-interval="'+t+'"]').parent().parent():this.$('.months li[data-interval="'+t+'"]'),this.$(".months li.selected").removeClass("selected"),e.addClass("selected"),r=e.parents(".year"),r.hasClass("selected")===!1?(this.$(".year.selected").removeClass("selected"),r.addClass("selected"),this.checkSizeOfNav()):void 0},r.prototype.gotoInterval=function(t){var e,r;return e=this.$$(t.target).closest("li"),r=e.data("interval"),this.trainingLogViewModel.gotoInterval(r,this)},r.prototype.addRace=function(t){var e;return e='.months li[data-interval="'+t.interval.get("month_interval")+'"] .races',this.$(e).append(JST["athletes/training_log/race"](t)),this.$("#race-"+t.activity.id).fadeIn(function(t){return function(){return t.checkSizeOfNav()}}(this))},r.prototype.removeRace=function(t){var e;return e=this,this.$("#race-"+t.activity.id).fadeOut(function(){return this.remove(),e.checkSizeOfNav()})},r.prototype.checkSizeOfNav=function(t){var e;return null==t&&(t=!0),this.navHeight=t?this.$el.height():this.navHeight,e=jQuery(window).height(),this.navHeight<e?this.fitsViewport():this.exceedsViewport()},r.prototype.exceedsViewport=function(){return this.$el.addClass("exceeds-viewport")},r.prototype.fitsViewport=function(){return this.$el.removeClass("exceeds-viewport")},r}(Backbone.View)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Athletes.TrainingLog"),Strava.Athletes.TrainingLog.Races=function(e){function r(t){r.__super__.constructor.call(this),this.from=t}return t(r,e),r.prototype.model=Strava.Athletes.TrainingLog.Race,r.prototype.url=function(){return"/athlete/training/races?from="+this.from},r}(Backbone.Collection)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Athletes.TrainingLog"),Strava.Athletes.TrainingLog.Tooltip=function(e){function r(){var t,e;r.__super__.constructor.call(this),this.initializeAttributes(n),e="strava-tt-"+this.token(),this.id(e),t=jQuery(document.createElement("div")),t.attr("id",e),t.attr("class",this.className()),jQuery(this.container()).append(t),this.el(jQuery("#"+e))}var n;return t(r,e),n={el:null,left:0,top:0,className:"strava-tt",id:"",content:"",isVisible:!1,container:document.body,track:!0,token:Math.round(1e3*Math.random()),offsetX:0,offsetY:0,hideDelay:300,showDelay:400,timer:null},r.prototype.show=function(){var t;return clearTimeout(this.timer()),t=function(t){return function(){return t.isVisible(!0),t.el().addClass("tt-visible")}}(this),this.timer(setTimeout(t,this.showDelay())),this},r.prototype.hide=function(t){var e;return null==t&&(t=null),clearTimeout(this.timer()),e=function(e){return function(){return e.isVisible(!1),e.el().removeClass("tt-visible"),null!=t?t():void 0}}(this),this.timer(setTimeout(e,this.hideDelay())),this},r.prototype.position=function(t,e){var r;return r=this.el(),t+=this.offsetX(),e+=this.offsetY(),this.left(t),this.top(e),this.el().css({left:t+"px",top:e+"px"}),this},r.prototype.above=function(t){return null==t&&(t=!1),this.el().toggleClass("tooltip-above",t),this},r.prototype.contents=function(t){return this.el().html(t),this},r}(Strava.Base)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["athletes/training_log/tt_content"]=function(t){return function(){var t,e,r,n,i,a,o,s,u,l,c,h,p;if(e=window.HAML.escape,t=window.HAML.cleanValue,r=[],n=new Strava.I18n.DateTimeFormatter,h=new Strava.Util.StringUtils,i=null!=this.description?h.shorten(this.description,70):"",this.canEditWorkoutType){for(r.push("<div class='drop-down-menu drop-down-xs workout-type-toggle' tabindex='"+e(t(0))+"' data-activity-id='"+e(t(this.activityId))+"'>"),l=this.workoutTypes,a=0,s=l.length;s>a;a++)p=l[a],this.workoutTypeId===p.value&&r.push("  <div class='selection'>\n    <span class='tt-workoutType "+this.sport+"-type-"+p.value+"'>\n      <div class='key-chip'></div>\n    </span>\n    <div class='workout-label'>"+e(t(Strava.I18n.Locale.t(p.key)))+"</div>\n  </div>");for(r.push("  <ul class='options'>"),c=this.workoutTypes,o=0,u=c.length;u>o;o++)p=c[o],r.push("    <li>\n      <div class='clickable' data-value='"+e(t(p.value))+"'>"+e(t(Strava.I18n.Locale.t(p.key)))+"</div>\n    </li>");r.push("  </ul>\n</div>")}else r.push("<h5 class='"+["tt-workout-type","tt-workout-type-"+e(t(this.sport))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n  <span class='key-chip'></span>"),r.push("  "+e(t(Strava.I18n.Locale.t("strava.activities.types."+this.sport)))),r.push("</h5>");return r.push("<h5 class='tt-date'>"+e(t(n.formatUTC(this.date,{format:"additional",type:"yMMMEd"})+" "+n.formatUTC(this.date,{format:"additional",type:"hm"})))+"</h5>\n<h4 class='tt-name'>\n  <a href='/activities/"+e(t(this.activityId))+"'>"+e(t(this.name))+"</a>\n</h4>"),i.length>0&&r.push("<p class='tt-description'>"+e(t(i))+"</p>"),r.push("<table class='dense unstyled'>\n  <tbody>\n    <tr>\n      <td class='metric-label'>"+e(t(Strava.I18n.Locale.t("templates.athletes.training_log.tt_content.distance")))+"</td>\n      <td>"+e(t(this.distance))+"</td>\n    </tr>\n    <tr>\n      <td class='metric-label'>"+e(t(Strava.I18n.Locale.t(this.timeKey)))+"</td>\n      <td>"+e(t(this.time))+"</td>\n    </tr>"),"run"===this.sport&&r.push("    <tr>\n      <td class='metric-label'>"+e(t(Strava.I18n.Locale.t("templates.athletes.training_log.tt_content.average_pace")))+"</td>\n      <td>"+e(t(this.pace))+"</td>\n    </tr>"),"ride"===this.sport&&(r.push("    <tr>\n      <td class='metric-label'>"+e(t(Strava.I18n.Locale.t("templates.athletes.training_log.tt_content.average_speed")))+"</td>\n      <td>"+e(t(this.speed))+"</td>\n    </tr>"),this.avg_watts>0&&r.push("    <tr>\n      <td class='metric-label'>"+e(t(Strava.I18n.Locale.t("templates.athletes.training_log.tt_content.average_watts")))+"</td>\n      <td>"+e(t((new Strava.I18n.PowerFormatter).formatShort(this.avg_watts)))+"</td>\n    </tr>")),("ride"===this.sport||"run"===this.sport)&&r.push("    <tr>\n      <td class='metric-label'>"+e(t(Strava.I18n.Locale.t("templates.athletes.training_log.tt_content.elevation_gain")))+"</td>\n      <td>"+e(t(this.elev))+"</td>\n    </tr>"),r.push("  </tbody>\n</table>\n<div class='tt-hit-area'></div>"),r.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Athletes.TrainingLog"),Strava.Athletes.TrainingLog.TooltipView=function(e){function r(t,e){this.trainingLogViewModel=t,r.__super__.constructor.call(this,e)}return t(r,e),r.prototype.template="athletes/training_log/tt_content",r.prototype.events={"click .workout-type-toggle .clickable":"handleWorkoutTypeChange"},r.prototype.render=function(t){var e;return this.workoutTypeId=t.workoutTypeId,t.canEditWorkoutType=this.trainingLogViewModel.athleteId()===currentAthlete.id&&("run"===(e=t.sport)||"ride"===e),this.renderTemplate(t),this.delegateEvents(),this},r.prototype.cleanup=function(){return this.undelegateEvents(),this.$el.empty()},r.prototype.handleWorkoutTypeChange=function(t){var e,r,n,i,a;return e=this.$(".workout-type-toggle"),r=this.$(t.target),n=e.data("activity-id"),i=parseInt(r.data("value"),10),a=r.text(),this.trainingLogViewModel.changeWorkoutType(n,this.workoutTypeId,i),this.changeWorkoutType(i,a)},r.prototype.changeWorkoutType=function(t,e){return this.workoutTypeId=t,this.$(".workout-label").text(e),this.$(".tt-workoutType").attr("class","tt-workoutType run-type-"+t)
},r}(Backbone.View)}.call(this),function(){Strava.module("Strava.Athletes.TrainingLog"),Strava.Athletes.TrainingLog.Tracker=function(){function t(t){this.sport=t,this.category="Training Log - "+this.sport}return t}()}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Athletes.TrainingLog"),Strava.Athletes.TrainingLog.TrainingHeaderView=function(e){function r(t,e){r.__super__.constructor.call(this,e),this.trainingLogViewModel=t,this.trainingLogViewModel.on("monthChanged",function(t){return function(e,r){return t.updateMonth(e,r)}}(this)),this.dateTimeFormatter=new TwitterCldr.DateTimeFormatter,Strava.Util.Fixies.fixElement(this.el)}return t(r,e),r.prototype.events={"click #scale-by .clickable":"updateScaleValue"},r.prototype.updateMonth=function(t,e){var r,n;return r=new Date(e,t-1),n=this.dateTimeFormatter.format(r,{format:"additional",type:"yMMM"}),this.$("#current-month").text(n)},r.prototype.updateScaleValue=function(t){var e,r;return e=this.$(t.target),r=e.data("value"),this.$(".selection").text(e.text()),this.trainingLogViewModel.changeScaleValue(r)},r}(Backbone.View)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Athletes.TrainingLog"),Strava.Athletes.TrainingLog.TrainingLogLightboxView=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.events={"click #lightbox-share-cta":"handleShare"},r.prototype.initialize=function(){return this.template=this.createTemplate("#training-log-share")},r.prototype.render=function(){return this.renderTemplate({})},r.prototype.handleShare=function(t){return t.stopPropagation(),this.trigger("trainingLogStartSharing")},r}(Backbone.View)}.call(this),function(){Strava.module("Strava.Athletes.TrainingLog"),Strava.Athletes.TrainingLog.TrainingLogViewModel=function(){function t(t,e,r,n){this.sport=t.toLowerCase(),this.scaleBy="triathlon"===this.sport?"moving_time":"distance",this.currentInterval=e,this.currentYear=r.year(e),this.currentMonth=r.month(e),this.intervals=r,this.activitiesController=n,this.activitiesController.on("workoutTypeChanged",function(t){return function(e,r,n){return t.handleWorkoutTypeChange(e,r,n)}}(this))}return Strava.includeModule(t,Backbone.Events),t.prototype.monthsBefore=1,t.prototype.monthsAfter=2,t.prototype.gotoInterval=function(t,e){var r,n,i,a;return this.currentInterval=t,r=this.intervals.month(t),a=this.intervals.year(t),this.currentYear!==a&&(this.trigger("yearChanged",a),this.currentYear=a),this.currentMonth!==r&&(this.trigger("monthChanged",r,a),this.currentMonth=r),n=this.intervals.getMonthInterval(t).month_interval,i=this.intervals.months(n,this.monthsBefore,this.monthsAfter),i.length>0&&this.intervals.fetchMonths(i),this.trigger("atInterval",t,e)},t.prototype.changeScaleValue=function(t){return this.scaleBy!==t?(this.scaleBy=t,this.trigger("scaleChanged",this.scaleBy)):void 0},t.prototype.changeWorkoutType=function(t,e,r){return this.activitiesController.updateWorkoutType(t,e,r)},t.prototype.handleWorkoutTypeChange=function(t,e,r){var n,i;return n=this.intervals.findActivity(t),n.interval.updateActivityWorkoutType(n.activity,r),i=Strava.Activities.Workouts.valueForKey(n.activity.type.toLowerCase(),"race"),e===i&&this.trigger("removeRace",n),r===i&&this.trigger("addRace",n),this.trigger("updateActivity",t,"workout_type",r)},t.prototype.athleteId=function(){return this.intervals.athleteId},t}()}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Athletes.TrainingLog"),Strava.Athletes.TrainingLog.TrainingLogVisibilityView=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.events={"click #privacy-control-toggle":"handleTogglingOptions","click .cancel":"handleTogglingOptions","click #training-log-share-url":"copySharingLink","submit #privacy-control-options":"setVisibility"},r.prototype.initialize=function(t,e){return this.athlete=e,this.athlete.on("change:training_log_shared",function(t){return function(){return t.updateVisibility()}}(this)),this.label=t.label,this.tooltip=t.tooltip,this.clipboardNotice=t.clipboardNotice,this.athleteId=t.athleteId,this.hasEnhancedPrivacy=t.hasEnhancedPrivacy,this.changeToPublic=!1,t.openLightbox&&this.renderLightbox(),this.$$("body").on("click",function(t){return function(e){t.$el[0]&&!t.$el[0].contains(e.target)&&t.$el.find("#privacy-control-options").removeClass("visible"),t.$$("body").find(".training-log-share")[0]&&!t.$$("body").find(".training-log-share")[0].contains(e.target)&&t.$el.find("#privacy-tooltip").removeClass("visible")}}(this))},r.prototype.renderLightbox=function(){var t;return this.lightbox=new Strava.Ui.LightboxView("training-log-share",{closeOnDocument:!1}),t=new Strava.Athletes.TrainingLog.TrainingLogLightboxView,t.bind("trainingLogStartSharing",function(t){return function(){return t.startSharing()}}(this)),this.lightbox.bind("lightboxClosed",function(t){return function(){return t.handleLightboxClose()}}(this)),this.lightbox.renderWithRenderer(t)},r.prototype.handleLightboxClose=function(){var t,e;return jQuery.ajax({url:"/athlete/athlete_preferences/set",data:{name:"seen_share_training_log",value:!0},type:"PUT"}),t=this.$("#privacy-tooltip"),e=this.changeToPublic?this.tooltip["public"]:this.tooltip["private"],t.text(e),t.addClass("visible")},r.prototype.startSharing=function(){return this.logTrainingLogStartShareFromPrompt(),this.$el.find("#training_log_shared_true")[0].checked=!0,this.athlete.set({training_log_shared:"true"}),this.athlete.save(),this.changeToPublic=!0,this.lightbox.closeBox()},r.prototype.updateVisibility=function(){var t;return"true"===this.athlete.get("training_log_shared")?(t=this.label["public"],this.$el.find("#privacy-control-toggle .app-icon").removeClass("icon-dark")):(t=this.label["private"],this.$el.find("#privacy-control-toggle .app-icon").addClass("icon-dark")),this.$el.find("#privacy-control-toggle .btn-label").text(t)},r.prototype.handleTogglingOptions=function(t){return t.stopPropagation(),this.$("#privacy-tooltip").removeClass("visible"),this.toggleOptions()},r.prototype.toggleOptions=function(){return this.$el.find("#privacy-control-options").toggleClass("visible")},r.prototype.setVisibility=function(t){var e;return t.preventDefault(),e=this.$(t.target).serializeObject(),this.athlete.set(e),this.athlete.save(),this.toggleOptions()},r.prototype.logTrainingLogStartShareFromPrompt=function(){var t;return t={page:"training-log",action:"start-sharing-training-log-from-prompt",event_details:[{key:"has-enhanced-privacy-on",value:this.hasEnhancedPrivacy}]},Strava.Util.EventLogging.trackEvent("CLIENT_ACTION",t)},r.prototype.copySharingLink=function(t){var e,r,n,i,a,o;t.preventDefault(),o=document.createElement("div"),o.id="training-log-clipboard",o.className="vh",a=document.createTextNode(t.target.href),o.appendChild(a),this.$el.append(o),r=document.createRange(),r.selectNode(o),window.getSelection().addRange(r);try{document.queryCommandSupported("copy")?(document.execCommand("copy"),e=this.$(".copy-to-clipboard"),e.text(this.clipboardNotice),e.fadeIn(200).delay(3e3).fadeOut(200)):window.location.href=t.target.href}catch(i){n=i,window.location.href=t.target.href}return window.getSelection().removeAllRanges(),o.remove()},r}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["athletes/training_log/xt_tt_content"]=function(t){return function(){var t,e,r,n,i,a,o,s,u;for(e=window.HAML.escape,t=window.HAML.cleanValue,r=[],a=new Strava.Util.RunDataFormatter,i=new Strava.I18n.DateTimeFormatter,r.push("<h5 class='tt-date'>"+e(t(i.formatUTC(this.date,{format:"additional",type:"yMMMEd"})))+"</h5>\n<ul class='xt-activities'>"),u=this.xt_activities,o=0,s=u.length;s>o;o++)n=u[o],r.push("  <li>\n    <strong>"+e(t(Strava.I18n.Locale.t("strava.activities.types."+n.type.toLowerCase())))+"</strong>\n    <a href='/activities/"+e(t(n.id))+"'>"+e(t(n.name))+"</a>\n    <ul class='inline-stats'>"),n.distance>0&&r.push("      <li>"+e(t(a.formatDistance(n.distance,!0)))+"</li>"),r.push("      <li>"+e(t(a.formatActivityDuration(n.moving_time)))+"</li>"),n.elev_gain>0&&r.push("      <li>"+e(t(a.formatElevation(n.elev_gain,!0)))+"</li>"),r.push("    </ul>\n  </li>");return r.push("</ul>\n<div class='tt-hit-area'></div>"),r.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Athletes.TrainingLog"),Strava.Athletes.TrainingLog.XTTooltipView=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.template="athletes/training_log/xt_tt_content",r.prototype.render=function(t){return this.renderTemplate(t),this},r}(Backbone.View)}.call(this),d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})};